import{a as Z}from"./chunk-FZJGQSSN.js";import"./chunk-OATTNESZ.js";import{b as L,d as N,e as O,f as z,g as R,h as G,l as H,m as J,n as K,q as Q,r as X,t as Y}from"./chunk-46JGFRV7.js";import{b as j}from"./chunk-STP3WM4P.js";import{x as W}from"./chunk-3KOIEGY5.js";import{Ac as I,Bb as k,Ca as f,Cb as P,Da as x,Db as n,Eb as i,Fb as p,Gb as M,Hb as C,Ib as m,Lb as h,Mb as r,Nb as U,Ob as b,Pb as F,Qb as V,Rb as v,Sb as y,Tb as E,Vb as A,hb as o,na as D,nb as S,sb as u,ta as B,vb as w,xb as T,yb as q,zb as s}from"./chunk-PHL42RAN.js";var $=(t,d)=>d.id;function ee(t,d){t&1&&(n(0,"p"),r(1,"La ciudad es obligatoria"),i())}function te(t,d){t&1&&(n(0,"p"),r(1,"La ciudad no puede tener m\xE1s de 50 caracteres"),i())}function ie(t,d){if(t&1&&(n(0,"div",34),u(1,ee,2,0,"p")(2,te,2,0,"p"),i()),t&2){m();let e=h(10);o(),s(e.errors!=null&&e.errors.required?1:-1),o(),s(e.errors!=null&&e.errors.maxlength?2:-1)}}function ne(t,d){t&1&&(n(0,"p"),r(1,"El departamento es obligatorio"),i())}function ae(t,d){t&1&&(n(0,"p"),r(1,"El departamento no puede tener m\xE1s de 50 caracteres"),i())}function oe(t,d){if(t&1&&(n(0,"div",34),u(1,ne,2,0,"p")(2,ae,2,0,"p"),i()),t&2){m();let e=h(18);o(),s(e.errors!=null&&e.errors.required?1:-1),o(),s(e.errors!=null&&e.errors.maxlength?2:-1)}}function re(t,d){t&1&&(n(0,"div",34)(1,"p"),r(2,"Este departamento ya existe"),i()())}function de(t,d){t&1&&(n(0,"p"),r(1,"La descripci\xF3n de la ciudad es obligatoria"),i())}function le(t,d){t&1&&(n(0,"p"),r(1,"La descripci\xF3n no puede tener m\xE1s de 120 caracteres"),i())}function ce(t,d){if(t&1&&(n(0,"div",34),u(1,de,2,0,"p")(2,le,2,0,"p"),i()),t&2){m();let e=h(27);o(),s(e.errors!=null&&e.errors.required?1:-1),o(),s(e.errors!=null&&e.errors.maxlength?2:-1)}}function se(t,d){t&1&&(n(0,"p"),r(1,"La descripci\xF3n del departamento es obligatoria"),i())}function me(t,d){t&1&&(n(0,"p"),r(1,"La descripci\xF3n no puede tener m\xE1s de 120 caracteres"),i())}function ue(t,d){if(t&1&&(n(0,"div",34),u(1,se,2,0,"p")(2,me,2,0,"p"),i()),t&2){m();let e=h(35);o(),s(e.errors!=null&&e.errors.required?1:-1),o(),s(e.errors!=null&&e.errors.maxlength?2:-1)}}function pe(t,d){t&1&&(p(0,"i",46),r(1," Guardando... "))}function _e(t,d){t&1&&(p(0,"i",47),r(1," Crear Ubicaci\xF3n "))}function ge(t,d){t&1&&p(0,"i",50)}function fe(t,d){t&1&&p(0,"i",51)}function xe(t,d){if(t&1&&(n(0,"div",48)(1,"div",49),u(2,ge,1,0,"i",50)(3,fe,1,0,"i",51),n(4,"span"),r(5),i()()()),t&2){let e=m(2);q(e.esExito()?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"),o(2),s(e.esExito()?2:3),o(3),U(e.mensajeResultado())}}function be(t,d){if(t&1){let e=M();n(0,"div",10)(1,"h2",12),p(2,"i",29),r(3," Crear Nueva Ubicaci\xF3n "),i(),n(4,"form",30,0),C("ngSubmit",function(){f(e);let a=m();return x(a.onSubmit())}),n(6,"div")(7,"label",31),r(8," Ciudad * "),i(),n(9,"input",32,1),E("ngModelChange",function(a){f(e);let c=m();return y(c.formData.ciudad,a)||(c.formData.ciudad=a),x(a)}),i(),n(11,"div",33),r(12),i(),u(13,ie,3,2,"div",34),i(),n(14,"div")(15,"label",35),r(16," Departamento * "),i(),n(17,"input",36,2),E("ngModelChange",function(a){f(e);let c=m();return y(c.formData.departamento,a)||(c.formData.departamento=a),x(a)}),C("blur",function(){f(e);let a=m();return x(a.validateDepartamentoUniqueness())}),i(),n(19,"div",33),r(20),i(),u(21,oe,3,2,"div",34)(22,re,3,0,"div",34),i(),n(23,"div")(24,"label",37),r(25," Descripci\xF3n de la Ciudad * "),i(),n(26,"textarea",38,3),E("ngModelChange",function(a){f(e);let c=m();return y(c.formData.descripcionCiudad,a)||(c.formData.descripcionCiudad=a),x(a)}),i(),n(28,"div",33),r(29),i(),u(30,ce,3,2,"div",34),i(),n(31,"div")(32,"label",39),r(33," Descripci\xF3n del Departamento * "),i(),n(34,"textarea",40,4),E("ngModelChange",function(a){f(e);let c=m();return y(c.formData.descripcionDepartamento,a)||(c.formData.descripcionDepartamento=a),x(a)}),i(),n(36,"div",33),r(37),i(),u(38,ue,3,2,"div",34),i(),n(39,"div",41)(40,"button",42),u(41,pe,2,0)(42,_e,2,0),i(),n(43,"button",43),C("click",function(){f(e);let a=m();return x(a.resetForm())}),p(44,"i",44),r(45," Limpiar "),i()()(),u(46,xe,6,4,"div",45),i()}if(t&2){let e=h(5),l=h(10),a=h(18),c=h(27),_=h(35),g=m();o(9),v("ngModel",g.formData.ciudad),o(3),b(" ",g.formData.ciudad.length,"/50 caracteres "),o(),s(l.invalid&&l.touched?13:-1),o(4),T("border-red-500",g.departamentoExists()),v("ngModel",g.formData.departamento),o(3),b(" ",g.formData.departamento.length,"/50 caracteres "),o(),s(a.invalid&&a.touched?21:-1),o(),s(g.departamentoExists()?22:-1),o(4),v("ngModel",g.formData.descripcionCiudad),o(3),b(" ",g.formData.descripcionCiudad.length,"/120 caracteres "),o(),s(c.invalid&&c.touched?30:-1),o(4),v("ngModel",g.formData.descripcionDepartamento),o(3),b(" ",g.formData.descripcionDepartamento.length,"/120 caracteres "),o(),s(_.invalid&&_.touched?38:-1),o(2),w("disabled",e.invalid||g.departamentoExists()||g.ubicacionService.loading()),o(),s(g.ubicacionService.loading()?41:42),o(5),s(g.mensajeResultado()?46:-1)}}function Ce(t,d){t&1&&(n(0,"div",27),p(1,"i",52),n(2,"span",8),r(3,"Buscando ubicaciones..."),i()())}function he(t,d){t&1&&(n(0,"p",55),r(1," Intenta con otros t\xE9rminos de b\xFAsqueda "),i())}function ve(t,d){if(t&1&&(n(0,"div",28),p(1,"i",53),n(2,"p",54),r(3,"No se encontraron ubicaciones"),i(),u(4,he,2,0,"p",55),i()),t&2){let e=m();o(4),s(e.filtrosBusqueda.texto?4:-1)}}function ye(t,d){if(t&1){let e=M();n(0,"button",71),C("click",function(){f(e);let a=m().$implicit,c=m(2);return x(c.eliminarUbicacion(a.id))}),p(1,"i",72),i()}}function Ee(t,d){if(t&1&&(n(0,"div",57)(1,"div",59)(2,"div",60)(3,"div",61),p(4,"i",62),n(5,"h4",63),r(6),i(),n(7,"span",64),r(8,"\u2022"),i(),n(9,"span",65),r(10),i()(),n(11,"div",66)(12,"strong"),r(13,"Ciudad:"),i(),r(14),i(),n(15,"div",67)(16,"strong"),r(17,"Departamento:"),i(),r(18),i()(),n(19,"div",68)(20,"span",69),r(21),i(),u(22,ye,2,0,"button",70),i()()()),t&2){let e=d.$implicit,l=m(2);o(6),U(e.ciudad),o(4),U(e.departamento),o(4),b(" ",e.descripcionCiudad," "),o(4),b(" ",e.descripcionDepartamento," "),o(3),b(" ",l.formatDate(e.fechaCreacion)," "),o(),s(l.isAdmin()?22:-1)}}function Se(t,d){if(t&1){let e=M();n(0,"div",58)(1,"div",67),r(2),i(),n(3,"div",73)(4,"button",74),C("click",function(){f(e);let a=m(2);return x(a.cambiarPagina(a.paginacion().page-1))}),p(5,"i",75),i(),n(6,"span",76),r(7),i(),n(8,"button",74),C("click",function(){f(e);let a=m(2);return x(a.cambiarPagina(a.paginacion().page+1))}),p(9,"i",77),i()()()}if(t&2){let e=m(2);o(2),V(" Mostrando ",(e.paginacion().page-1)*e.paginacion().pageSize+1," - ",e.Math.min(e.paginacion().page*e.paginacion().pageSize,e.paginacion().total)," de ",e.paginacion().total," ubicaciones "),o(2),w("disabled",e.paginacion().page===1),o(3),F(" ",e.paginacion().page," / ",e.paginacion().totalPages," "),o(),w("disabled",e.paginacion().page===e.paginacion().totalPages)}}function we(t,d){if(t&1&&(n(0,"div",56),k(1,Ee,23,6,"div",57,$),i(),u(3,Se,10,7,"div",58)),t&2){let e=m();o(),P(e.resultadosBusqueda()),o(2),s(e.paginacion().totalPages>1?3:-1)}}var Ve=(()=>{class t{ubicacionService=D(Z);authFacade=D(W);resultadosBusqueda=S([]);paginacion=S({page:1,pageSize:5,total:0,totalPages:0});mensajeResultado=S("");esExito=S(!1);departamentoExists=S(!1);formData={ciudad:"",departamento:"",descripcionCiudad:"",descripcionDepartamento:""};filtrosBusqueda={texto:"",ordenAscendente:!0,ordenarPor:"ciudad",page:1,pageSize:5};Math=Math;ngOnInit(){this.cargarUbicaciones()}isAdmin(){return this.authFacade.getCurrentUser()?.role===j.ADMIN}onSubmit(){if(!this.isAdmin()){this.mostrarMensaje("No tienes permisos para crear ubicaciones",!1);return}if(this.departamentoExists()){this.mostrarMensaje("El departamento ya existe",!1);return}this.ubicacionService.createUbicacion(this.formData).subscribe({next:e=>{e.success?(this.mostrarMensaje(e.message,!0),this.resetForm(),this.cargarUbicaciones()):this.mostrarMensaje(e.message,!1)},error:e=>{this.mostrarMensaje("Error al crear la ubicaci\xF3n",!1),console.error("Error:",e)}})}validateDepartamentoUniqueness(){if(this.formData.departamento.trim()){let e=this.ubicacionService.isDepartamentoExists(this.formData.departamento);this.departamentoExists.set(e)}else this.departamentoExists.set(!1)}onBuscar(){this.filtrosBusqueda.page=1,this.realizarBusqueda()}realizarBusqueda(){this.ubicacionService.searchUbicaciones(this.filtrosBusqueda).subscribe({next:e=>{this.resultadosBusqueda.set(e.ubicaciones),this.paginacion.set({page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages})},error:e=>{console.error("Error en b\xFAsqueda:",e),this.resultadosBusqueda.set([])}})}cambiarPagina(e){e>=1&&e<=this.paginacion().totalPages&&(this.filtrosBusqueda.page=e,this.realizarBusqueda())}cargarUbicaciones(){this.realizarBusqueda()}eliminarUbicacion(e){if(!this.isAdmin()){this.mostrarMensaje("No tienes permisos para eliminar ubicaciones",!1);return}confirm("\xBFEst\xE1 seguro de que desea eliminar esta ubicaci\xF3n?")&&this.ubicacionService.deleteUbicacion(e).subscribe({next:l=>{l.success?(this.mostrarMensaje("Ubicaci\xF3n eliminada exitosamente",!0),this.cargarUbicaciones()):this.mostrarMensaje(l.message,!1)},error:l=>{this.mostrarMensaje("Error al eliminar la ubicaci\xF3n",!1),console.error("Error:",l)}})}resetForm(){this.formData={ciudad:"",departamento:"",descripcionCiudad:"",descripcionDepartamento:""},this.departamentoExists.set(!1),this.mensajeResultado.set("")}mostrarMensaje(e,l){this.mensajeResultado.set(e),this.esExito.set(l),setTimeout(()=>{this.mensajeResultado.set("")},5e3)}formatDate(e){return new Date(e).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"})}static \u0275fac=function(l){return new(l||t)};static \u0275cmp=B({type:t,selectors:[["app-ubicaciones"]],standalone:!0,features:[A],decls:39,vars:16,consts:[["ubicacionForm","ngForm"],["ciudad","ngModel"],["departamento","ngModel"],["descripcionCiudad","ngModel"],["descripcionDepartamento","ngModel"],[1,"ubicaciones-page","p-6","bg-gray-50","min-h-screen"],[1,"bg-white","shadow-sm","rounded-lg","p-6","mb-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"grid"],[1,"bg-white","shadow-sm","rounded-lg","p-6","mb-6","lg:mb-0"],[1,"bg-white","shadow-sm","rounded-lg","p-6"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"fas","fa-search","text-green-500","mr-2"],[1,"space-y-4","mb-6"],["for","textoBusqueda",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"relative"],["type","text","id","textoBusqueda","placeholder","Escribe para buscar...",1,"w-full","pl-10","pr-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent",3,"ngModelChange","input","ngModel"],[1,"fas","fa-search","absolute","left-3","top-3","text-gray-400"],[1,"grid","grid-cols-2","gap-3"],["for","ordenarPor",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","ordenarPor",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value","ciudad"],["value","departamento"],["for","orden",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","orden",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],[3,"value"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center","py-8"],[1,"fas","fa-plus-circle","text-blue-500","mr-2"],[1,"space-y-4",3,"ngSubmit"],["for","ciudad",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","ciudad","name","ciudad","required","","maxlength","50","placeholder","Ingrese el nombre de la ciudad",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500","mt-1"],[1,"text-red-500","text-sm","mt-1"],["for","departamento",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","departamento","name","departamento","required","","maxlength","50","placeholder","Ingrese el nombre del departamento",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","blur","ngModel"],["for","descripcionCiudad",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","descripcionCiudad","name","descripcionCiudad","required","","maxlength","120","rows","3","placeholder","Describe caracter\xEDsticas importantes de la ciudad",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","resize-none",3,"ngModelChange","ngModel"],["for","descripcionDepartamento",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","descripcionDepartamento","name","descripcionDepartamento","required","","maxlength","120","rows","3","placeholder","Describe caracter\xEDsticas importantes del departamento",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-3","pt-4"],["type","submit",1,"flex-1","bg-blue-600","text-white","px-4","py-2","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"disabled"],["type","button",1,"px-4","py-2","text-gray-600","border","border-gray-300","rounded-md","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-gray-500","focus:ring-offset-2","transition-colors",3,"click"],[1,"fas","fa-times","mr-2"],[1,"mt-4","p-3","rounded-md",3,"class"],[1,"fas","fa-spinner","fa-spin","mr-2"],[1,"fas","fa-save","mr-2"],[1,"mt-4","p-3","rounded-md"],[1,"flex"],[1,"fas","fa-check-circle","text-green-400","mr-2","mt-0.5"],[1,"fas","fa-exclamation-circle","text-red-400","mr-2","mt-0.5"],[1,"fas","fa-spinner","fa-spin","text-2xl","text-gray-400","mr-3"],[1,"fas","fa-map-marker-alt","text-4xl","text-gray-300","mb-3"],[1,"text-gray-500"],[1,"text-sm","text-gray-400","mt-1"],[1,"space-y-3"],[1,"border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors"],[1,"flex","justify-between","items-center","mt-6","pt-4","border-t","border-gray-200"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","mb-2"],[1,"fas","fa-city","text-blue-500","mr-2"],[1,"font-semibold","text-gray-900"],[1,"ml-2","text-sm","text-gray-500"],[1,"ml-2","text-sm","text-gray-600"],[1,"text-sm","text-gray-600","mb-1"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","space-x-2","ml-4"],[1,"text-xs","text-gray-400"],["title","Eliminar ubicaci\xF3n",1,"text-red-500","hover:text-red-700","p-1","rounded","transition-colors"],["title","Eliminar ubicaci\xF3n",1,"text-red-500","hover:text-red-700","p-1","rounded","transition-colors",3,"click"],[1,"fas","fa-trash","text-sm"],[1,"flex","space-x-2"],[1,"px-3","py-1","text-sm","border","border-gray-300","rounded-md","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"px-3","py-1","text-sm","bg-green-100","text-green-800","rounded-md"],[1,"fas","fa-chevron-right"]],template:function(l,a){l&1&&(n(0,"div",5)(1,"div",6)(2,"h1",7),r(3),i(),n(4,"p",8),r(5),i()(),n(6,"div",9),u(7,be,47,18,"div",10),n(8,"div",11)(9,"h2",12),p(10,"i",13),r(11),i(),n(12,"div",14)(13,"div")(14,"label",15),r(15," Buscar por ciudad o departamento "),i(),n(16,"div",16)(17,"input",17),E("ngModelChange",function(_){return y(a.filtrosBusqueda.texto,_)||(a.filtrosBusqueda.texto=_),_}),C("input",function(){return a.onBuscar()}),i(),p(18,"i",18),i()(),n(19,"div",19)(20,"div")(21,"label",20),r(22," Ordenar por "),i(),n(23,"select",21),E("ngModelChange",function(_){return y(a.filtrosBusqueda.ordenarPor,_)||(a.filtrosBusqueda.ordenarPor=_),_}),C("change",function(){return a.onBuscar()}),n(24,"option",22),r(25,"Ciudad"),i(),n(26,"option",23),r(27,"Departamento"),i()()(),n(28,"div")(29,"label",24),r(30," Orden "),i(),n(31,"select",25),E("ngModelChange",function(_){return y(a.filtrosBusqueda.ordenAscendente,_)||(a.filtrosBusqueda.ordenAscendente=_),_}),C("change",function(){return a.onBuscar()}),n(32,"option",26),r(33,"Ascendente"),i(),n(34,"option",26),r(35,"Descendente"),i()()()()(),u(36,Ce,4,0,"div",27)(37,ve,5,1,"div",28)(38,we,4,1),i()()()),l&2&&(o(3),b(" ",a.isAdmin()?"Gesti\xF3n de Ubicaciones":"Ubicaciones Disponibles"," "),o(2),b(" ",a.isAdmin()?"Crear y administrar ubicaciones (ciudades y departamentos)":"Buscar y explorar ubicaciones disponibles"," "),o(),T("lg:grid-cols-2",a.isAdmin())("lg:grid-cols-1",!a.isAdmin())("gap-6",a.isAdmin()),o(),s(a.isAdmin()?7:-1),o(4),b(" ",a.isAdmin()?"Buscar Ubicaciones":"Explorar Ubicaciones"," "),o(6),v("ngModel",a.filtrosBusqueda.texto),o(6),v("ngModel",a.filtrosBusqueda.ordenarPor),o(8),v("ngModel",a.filtrosBusqueda.ordenAscendente),o(),w("value",!0),o(2),w("value",!1),o(2),s(a.ubicacionService.loading()?36:a.resultadosBusqueda().length===0?37:38))},dependencies:[I,Y,G,J,K,L,H,N,O,Q,X,R,z],styles:[".ubicaciones-page[_ngcontent-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.transition-colors[_ngcontent-%COMP%]{transition:background-color .2s ease,border-color .2s ease,color .2s ease}.border-red-500[_ngcontent-%COMP%]{border-color:#ef4444!important}textarea[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}"]})}return t})();export{Ve as UbicacionesComponent};
