import{a as p}from"./chunk-OATTNESZ.js";import{O as g,ha as d,i as a,na as C,nb as m,s as l}from"./chunk-PHL42RAN.js";var E=(()=>{class c{localStorageService=C(p);categories=m([]);loading=m(!1);constructor(){this.categories.set(this.localStorageService.getCategories()),this.localStorageService.categories$.subscribe(t=>{this.categories.set(t)})}createCategory(t){return new a(e=>{setTimeout(()=>{let r=this.validateCategory(t);if(r.length>0){e.next({success:!1,message:r.join(", ")}),e.complete();return}if(this.isCategoryNameExists(t.nombre)){e.next({success:!1,message:"El nombre de la categor\xEDa ya existe"}),e.complete();return}let o=this.localStorageService.addCategory(t);e.next({success:!0,message:"Categor\xEDa creada exitosamente",category:o}),e.complete()},500)})}getCategories(){return l(this.localStorageService.getCategories()).pipe(g(300))}searchCategories(t={}){return new a(e=>{setTimeout(()=>{let o=this.localStorageService.getCategories();if(t.texto){let s=t.texto.toLowerCase();o=o.filter(i=>i.nombre.toLowerCase().includes(s)||i.descripcion.toLowerCase().includes(s))}t.ordenarPor&&o.sort((s,i)=>{let n=s[t.ordenarPor],u=i[t.ordenarPor];return t.ordenAscendente===!1?u.localeCompare(n):n.localeCompare(u)}),e.next(o),e.complete()},300)})}getCategoryById(t){return l(this.localStorageService.getCategoryById(t)).pipe(g(200))}updateCategory(t,e){return new a(r=>{setTimeout(()=>{let o=this.validateCategory(e);if(o.length>0){r.next({success:!1,message:o.join(", ")}),r.complete();return}if(this.isCategoryNameExists(e.nombre,t)){r.next({success:!1,message:"El nombre de la categor\xEDa ya existe"}),r.complete();return}let s=this.localStorageService.updateCategory(t,e);r.next({success:!0,message:"Categor\xEDa actualizada exitosamente",category:s}),r.complete()},500)})}deleteCategory(t){return new a(e=>{setTimeout(()=>{try{this.localStorageService.deleteCategory(t),e.next({success:!0,message:"Categor\xEDa eliminada exitosamente"}),e.complete()}catch(r){console.error("Error deleting category:",r),e.next({success:!1,message:r instanceof Error?r.message:"Error al eliminar la categor\xEDa"}),e.complete()}},500)})}validateCategory(t){let e=[];return!t.nombre||t.nombre.trim().length===0?e.push("El nombre es requerido"):t.nombre.length>50&&e.push("El nombre no puede exceder 50 caracteres"),!t.descripcion||t.descripcion.trim().length===0?e.push("La descripci\xF3n es requerida"):t.descripcion.length>200&&e.push("La descripci\xF3n no puede exceder 200 caracteres"),e}isCategoryNameExists(t,e){return this.localStorageService.getCategories().some(o=>o.nombre.toLowerCase()===t.toLowerCase()&&(!e||o.id!==e))}isNameUnique(t,e){return new a(r=>{setTimeout(()=>{let o=this.localStorageService.getCategories(),s=e?Number(e):void 0,i=o.some(n=>n.nombre.toLowerCase()===t.toLowerCase()&&(!s||n.id!==s));r.next(!i),r.complete()},200)})}static \u0275fac=function(e){return new(e||c)};static \u0275prov=d({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();export{E as a};
