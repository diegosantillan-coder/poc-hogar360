import{a as j}from"./chunk-FTOEQC3Z.js";import{a as R}from"./chunk-DWWM3IXI.js";import"./chunk-OATTNESZ.js";import{x as H}from"./chunk-3KOIEGY5.js";import{f as U,h as P}from"./chunk-BZNYC5N3.js";import"./chunk-XOLXN3IC.js";import{Ac as N,Bb as I,Ca as f,Cb as L,Da as b,Db as t,Ea as m,Eb as i,Fa as p,Fb as d,Gb as y,Hb as S,Ib as l,Mb as r,Nb as V,Ob as u,Pb as M,Vb as F,db as k,f as h,hb as o,ic as w,mb as D,na as v,nb as _,sb as g,ta as T,vb as A,yb as C,zb as x}from"./chunk-PHL42RAN.js";var O=(a,c)=>c.id;function G(a,c){a&1&&(t(0,"div",4),d(1,"div",5),t(2,"p",6),r(3,"Cargando visitas..."),i()())}function q(a,c){if(a&1&&(t(0,"div",28),m(),t(1,"svg",32),d(2,"path",33),i(),p(),t(3,"span",34),r(4),i()()),a&2){let e=l().$implicit;o(4),V(e.comentarios)}}function B(a,c){if(a&1){let e=y();t(0,"button",35),S("click",function(){f(e);let s=l().$implicit,E=l(2);return b(E.cancelVisit(s.id))}),r(1," Cancelar "),i()}}function J(a,c){if(a&1&&(t(0,"a",31),r(1," Ver Mapa "),i()),a&2){let e=l().$implicit,n=l(2);A("href",n.getMapLink(e.horarioDisponible.casa),k)}}function K(a,c){if(a&1&&(t(0,"div",11)(1,"div",13)(2,"div",14)(3,"h3",15),r(4),i(),t(5,"div",16)(6,"div",17)(7,"div",18),m(),t(8,"svg",19),d(9,"path",20)(10,"path",21),i(),p(),t(11,"span"),r(12),i()(),t(13,"div",18),m(),t(14,"svg",19),d(15,"path",22),i(),p(),t(16,"span"),r(17),i()(),t(18,"div",18),m(),t(19,"svg",19),d(20,"path",23),i(),p(),t(21,"span"),r(22),i()()(),t(23,"div",17)(24,"div",18),m(),t(25,"svg",19),d(26,"path",24),i(),p(),t(27,"span",25),r(28),i()(),t(29,"div",18),m(),t(30,"svg",19),d(31,"path",26),i(),p(),t(32,"span",27),r(33),i()(),g(34,q,5,1,"div",28),i()()(),t(35,"div",29),g(36,B,2,0,"button",30)(37,J,2,1,"a",31),i()()()),a&2){let e=c.$implicit,n=l(2);o(4),u(" ",e.horarioDisponible.casa.nombre," "),o(8),M("",e.horarioDisponible.casa.ubicacion.ciudad,", ",e.horarioDisponible.casa.ubicacion.departamento,""),o(5),V(n.formatDateTime(e.horarioDisponible.fechaHoraInicio)),o(5),M("Vendedor: ",e.horarioDisponible.vendedor.nombre," ",e.horarioDisponible.vendedor.apellido,""),o(6),V(n.formatPrice(e.horarioDisponible.casa.precio)),o(4),C(n.getStatusColor(e.estado)),o(),u(" ",n.getStatusText(e.estado)," "),o(),x(e.comentarios?34:-1),o(2),x(n.canCancelVisit(e)?36:-1),o(),x(e.estado==="CONFIRMADA"&&n.isUpcoming(e)?37:-1)}}function Q(a,c){a&1&&(t(0,"a",40),r(1," Explorar Propiedades "),i())}function W(a,c){if(a&1&&(t(0,"div",12),m(),t(1,"svg",36),d(2,"path",37),i(),p(),t(3,"h3",38),r(4),i(),t(5,"p",39),r(6),i(),g(7,Q,2,0,"a",40),i()),a&2){let e=l(2);o(4),u(" ",e.activeTab()==="upcoming"?"No tienes visitas pr\xF3ximas":"No tienes visitas pasadas"," "),o(2),u(" ",e.activeTab()==="upcoming"?"Explora las propiedades disponibles y agenda tu primera visita":"Las visitas que hayas realizado aparecer\xE1n aqu\xED"," "),o(),x(e.activeTab()==="upcoming"?7:-1)}}function X(a,c){if(a&1){let e=y();t(0,"div",7)(1,"nav",8)(2,"button",9),S("click",function(){f(e);let s=l();return b(s.setActiveTab("upcoming"))}),r(3),i(),t(4,"button",9),S("click",function(){f(e);let s=l();return b(s.setActiveTab("past"))}),r(5),i()()(),t(6,"div",10),I(7,K,38,13,"div",11,O,!1,W,8,3,"div",12),i()}if(a&2){let e=l();o(2),C(e.activeTab()==="upcoming"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),o(),u(" Pr\xF3ximas (",e.upcomingVisits().length,") "),o(),C(e.activeTab()==="past"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),o(),u(" Pasadas (",e.pastVisits().length,") "),o(2),L(e.filteredVisits())}}var se=(()=>{class a{visitService=v(R);authFacade=v(H);alertService=v(j);viewContainerRef=v(D);visits=_([]);loading=_(!1);activeTab=_("upcoming");upcomingVisits=w(()=>this.visits().filter(e=>this.isUpcoming(e)));pastVisits=w(()=>this.visits().filter(e=>!this.isUpcoming(e)));filteredVisits=w(()=>this.activeTab()==="upcoming"?this.upcomingVisits():this.pastVisits());ngOnInit(){this.alertService.setViewContainerRef(this.viewContainerRef),this.loadUserVisits()}loadUserVisits(){this.loading.set(!0);let e=this.authFacade.getCurrentUser();e?.correo&&this.visitService.getUserVisits(e.correo).subscribe({next:n=>{this.visits.set(n),this.loading.set(!1)},error:n=>{console.error("Error loading user visits:",n),this.loading.set(!1)}})}setActiveTab(e){this.activeTab.set(e)}isUpcoming(e){return new Date(e.horarioDisponible.fechaHoraInicio)>new Date}canCancelVisit(e){let n=this.isUpcoming(e),s=e.estado==="PENDIENTE"||e.estado==="CONFIRMADA",E=new Date(e.horarioDisponible.fechaHoraInicio),z=new Date,$=(E.getTime()-z.getTime())/(1e3*60*60);return n&&s&&$>=2}cancelVisit(e){return h(this,null,function*(){(yield this.alertService.confirm("Confirmar cancelaci\xF3n","\xBFEst\xE1s seguro de que deseas cancelar esta visita?","Cancelar Visita","No cancelar"))&&this.visitService.cancelVisit(e).subscribe({next:()=>h(this,null,function*(){this.loadUserVisits(),yield this.alertService.success("Visita cancelada","La visita ha sido cancelada exitosamente")}),error:s=>h(this,null,function*(){console.error("Error canceling visit:",s),yield this.alertService.error("Error al cancelar","Error al cancelar la visita. Por favor, int\xE9ntelo nuevamente.")})})})}getStatusText(e){return{PENDIENTE:"Pendiente",CONFIRMADA:"Confirmada",CANCELADA:"Cancelada",COMPLETADA:"Completada"}[e]||e}getStatusColor(e){return{PENDIENTE:"text-yellow-600",CONFIRMADA:"text-green-600",CANCELADA:"text-red-600",COMPLETADA:"text-blue-600"}[e]||"text-gray-600"}formatDateTime(e){return new Date(e).toLocaleString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatPrice(e){return`$${e.toLocaleString("es-CO")}`}getMapLink(e){let n=`${e.ubicacion.ciudad}, ${e.ubicacion.departamento}, Colombia`;return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n)}`}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=T({type:a,selectors:[["app-visits"]],standalone:!0,features:[F],decls:7,vars:1,consts:[[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-6xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-6"],[1,"text-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto"],[1,"mt-2","text-gray-600"],[1,"border-b","border-gray-200","mb-6"],[1,"-mb-px","flex","space-x-8"],[1,"whitespace-nowrap","py-2","px-1","border-b-2","font-medium","text-sm",3,"click"],[1,"space-y-4"],[1,"border","border-gray-200","rounded-lg","p-6","hover:shadow-md","transition-shadow"],[1,"text-center","py-12"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm","text-gray-600"],[1,"space-y-2"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"],[1,"text-lg","font-semibold","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"capitalize"],[1,"flex","items-start"],[1,"ml-4","flex","flex-col","space-y-2"],[1,"px-3","py-1","text-xs","bg-red-600","text-white","rounded","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-red-500"],["target","_blank",1,"px-3","py-1","text-xs","bg-blue-600","text-white","rounded","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-center",3,"href"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"text-xs"],[1,"px-3","py-1","text-xs","bg-red-600","text-white","rounded","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-red-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-gray-400","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],["routerLink","/propiedades",1,"inline-flex","items-center","px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500"]],template:function(n,s){n&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Mis Visitas Agendadas"),i(),g(5,G,4,0,"div",4)(6,X,10,7),i()()()),n&2&&(o(5),x(s.loading()?5:6))},dependencies:[N,P,U],encapsulation:2})}return a})();export{se as VisitsComponent};
