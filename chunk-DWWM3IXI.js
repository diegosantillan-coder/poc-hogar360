import{a as u}from"./chunk-OATTNESZ.js";import{O as l,ha as c,na as n,nb as o,s,y as r}from"./chunk-PHL42RAN.js";var f=(()=>{class a{localStorageService=n(u);visitSchedules=o([]);visits=o([]);loading=o(!1);error=o(null);constructor(){this.visitSchedules.set(this.localStorageService.getVisitSchedules()),this.visits.set(this.localStorageService.getVisits()),this.localStorageService.visitSchedules$.subscribe(e=>{this.visitSchedules.set(e)}),this.localStorageService.visits$.subscribe(e=>{this.visits.set(e)})}createVisitSchedule(e){return this.loading.set(!0),this.error.set(null),s(e).pipe(l(300),r(()=>{let t=this.localStorageService.addVisitSchedule(e);return this.loading.set(!1),t}))}createSchedule(e){return this.createVisitSchedule(e)}getAvailableSchedules(e={}){return this.loading.set(!0),this.error.set(null),s(null).pipe(l(200),r(()=>{let t=this.localStorageService.getVisitSchedules();return e.fechaInicio&&(t=t.filter(i=>new Date(i.fechaHoraInicio)>=new Date(e.fechaInicio))),e.fechaFin&&(t=t.filter(i=>new Date(i.fechaHoraFin)<=new Date(e.fechaFin))),e.ubicacionId&&(t=t.filter(i=>i.casa.ubicacion.id===e.ubicacionId)),e.vendedorId&&(t=t.filter(i=>i.casa.vendedor_id===e.vendedorId)),this.loading.set(!1),t}))}getScheduleById(e){return s(null).pipe(l(200),r(()=>{let t=this.localStorageService.getVisitSchedules().find(i=>i.id===e);if(!t)throw new Error("Horario no encontrado");return t}))}scheduleVisit(e){return this.loading.set(!0),this.error.set(null),s(e).pipe(l(300),r(()=>{let t=this.localStorageService.addVisit(e);return this.loading.set(!1),t}))}getSchedulesByVendor(e){return s(null).pipe(l(200),r(()=>this.localStorageService.getVisitSchedules().filter(i=>i.casa.vendedor_id===e)))}getMySchedules(){return s(null).pipe(l(200),r(()=>this.localStorageService.getVisitSchedules()))}getVisitsByBuyer(e){return s(null).pipe(l(200),r(()=>this.localStorageService.getVisits().filter(i=>i.compradorEmail===e)))}getUserVisits(e){return this.loading.set(!0),this.error.set(null),s(e).pipe(l(300),r(()=>{let i=this.localStorageService.getVisits().filter(d=>d.compradorEmail===e);return this.loading.set(!1),i}))}updateVisitSchedule(e,t){return this.loading.set(!0),this.error.set(null),s(t).pipe(l(300),r(()=>{let i=this.localStorageService.updateVisitSchedule(e,t);return this.loading.set(!1),i}))}updateSchedule(e,t){return this.updateVisitSchedule(e,t)}deleteVisitSchedule(e){return this.loading.set(!0),this.error.set(null),s(null).pipe(l(300),r(()=>{this.localStorageService.deleteVisitSchedule(e),this.loading.set(!1)}))}deleteSchedule(e){return this.deleteVisitSchedule(e)}cancelVisit(e){return this.loading.set(!0),this.error.set(null),s(null).pipe(l(300),r(()=>{this.localStorageService.deleteVisit(e),this.loading.set(!1)}))}updateVisitStatus(e,t){return this.loading.set(!0),this.error.set(null),s({status:t}).pipe(l(300),r(()=>{let i=this.localStorageService.updateVisit(e,{status:t});return this.loading.set(!1),i}))}setError(e){this.error.set(e),this.loading.set(!1)}clearLoading(){this.loading.set(!1)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();export{f as a};
