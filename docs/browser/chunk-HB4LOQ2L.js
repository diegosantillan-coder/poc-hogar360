import{a as W}from"./chunk-FXWIRNBA.js";import{a as j}from"./chunk-FTOEQC3Z.js";import{a as ue}from"./chunk-U2IBHHR6.js";import"./chunk-OATTNESZ.js";import{b as ne,c as $,d as ie,e as ae,g as re,h as oe,j as se,l as le,m as ce,n as de,s as me,t as pe,u as ge}from"./chunk-46JGFRV7.js";import{b as te}from"./chunk-STP3WM4P.js";import{x as ee}from"./chunk-3KOIEGY5.js";import{Ab as z,Ac as P,Bb as F,Ca as C,Cb as M,Da as h,Db as a,Ea as S,Eb as o,Fa as U,Fb as y,Gb as x,H as J,Hb as g,Ib as d,J as K,La as O,Mb as c,Nb as Y,Ob as _,Pb as G,Qb as X,Rb as L,Sb as A,Tb as N,Vb as T,ba as Q,f as I,hb as r,mb as q,na as v,nb as b,s as B,sb as u,ta as w,ub as D,vb as p,w as k,xc as R,y as Z,yb as E,zb as f}from"./chunk-PHL42RAN.js";function ve(n,l){n&1&&(a(0,"span",5),c(1,"*"),o())}function we(n,l){if(n&1&&(a(0,"div",7)(1,"span",8),c(2),o()()),n&2){let e=d(2);r(2),G(" ",e.value.length,"/",e.maxLength," ")}}function Se(n,l){if(n&1){let e=x();a(0,"div",4)(1,"textarea",6),g("input",function(t){C(e);let s=d();return h(s.onInput(t))}),o(),u(2,we,3,2,"div",7),o()}if(n&2){let e=d();r(),E(e.getInputClasses()),p("value",e.value)("placeholder",e.placeholder)("rows",e.rows||5)("disabled",e.disabled),D("maxlength",e.maxLength),r(),f(e.showCounter&&e.maxLength?2:-1)}}function Te(n,l){n&1&&(a(0,"div",10),y(1,"div",11),a(2,"span",12),c(3,"Buscando coincidencias..."),o()())}function Pe(n,l){if(n&1){let e=x();a(0,"div",4)(1,"input",9),g("input",function(t){C(e);let s=d();return h(s.onInput(t))}),o()(),u(2,Te,4,0,"div",10)}if(n&2){let e=d();r(),E(e.getInputClasses()),p("type",e.type)("value",e.value)("placeholder",e.placeholder)("disabled",e.disabled),D("maxlength",e.maxLength),r(),f(e.loading?2:-1)}}function Ee(n,l){if(n&1&&(a(0,"p",13),c(1),o()),n&2){let e=l.$implicit;r(),Y(e)}}function Fe(n,l){if(n&1&&(a(0,"div",4),F(1,Ee,2,1,"p",13,z),o()),n&2){let e=d();r(),M(e.errors)}}var fe=(()=>{class n{label="";type="text";value="";placeholder="";required=!1;disabled=!1;maxLength;rows;showCounter=!1;errors=[];loading=!1;valueChange=new O;onInput(e){let i=e.target;this.valueChange.emit(i.value)}getInputClasses(){let e="block w-full rounded-lg transition-colors",i="px-3 py-3",t="border border-solid",s="bg-white",m=this.errors.length>0?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500",V=this.disabled?"bg-gray-100 cursor-not-allowed text-gray-500":"";return`${e} ${i} ${t} ${s} ${m} ${V} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20 text-base font-normal`}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=w({type:n,selectors:[["app-input-field"]],inputs:{label:"label",type:"type",value:"value",placeholder:"placeholder",required:"required",disabled:"disabled",maxLength:"maxLength",rows:"rows",showCounter:"showCounter",errors:"errors",loading:"loading"},outputs:{valueChange:"valueChange"},standalone:!0,features:[T],decls:8,vars:4,consts:[[1,"mb-6"],[1,"block"],[1,"text-sm","font-medium","text-gray-700"],["class","text-red-500 ml-1",4,"ngIf"],[1,"mt-2"],[1,"text-red-500","ml-1"],[3,"input","value","placeholder","rows","disabled"],[1,"flex","justify-end","mt-1"],[1,"text-sm","text-gray-500"],[3,"input","type","value","placeholder","disabled"],[1,"flex","items-center","mt-2"],[1,"w-4","h-4","border-2","border-blue-500","border-t-transparent","rounded-full","animate-spin","mr-2"],[1,"text-sm","text-blue-600"],[1,"text-sm","text-red-600"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"label",1)(2,"span",2),c(3),o(),u(4,ve,2,0,"span",3),o(),u(5,Se,3,8,"div",4)(6,Pe,3,8)(7,Fe,3,0,"div",4),o()),i&2&&(r(3),Y(t.label),r(),p("ngIf",t.required),r(),f(t.type==="textarea"?5:6),r(2),f(t.errors.length>0?7:-1))},dependencies:[P,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   input[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{appearance:none!important;background-image:none!important;font-family:inherit!important;font-size:1rem!important;line-height:1.5!important;margin:0!important;box-shadow:none!important;--tw-shadow: none !important}[_nghost-%COMP%]   input.block[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea.block[_ngcontent-%COMP%]{display:block!important;width:100%!important;padding:.75rem!important;border:1px solid #d1d5db!important;border-radius:.5rem!important;background-color:#fff!important;color:#374151!important;transition:all .2s ease-in-out!important}[_nghost-%COMP%]   input.block[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   textarea.block[_ngcontent-%COMP%]:focus{outline:none!important;border-color:#3b82f6!important;box-shadow:0 0 0 3px #3b82f61a!important}[_nghost-%COMP%]   input.border-red-300[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea.border-red-300[_ngcontent-%COMP%]{border-color:#fca5a5!important}[_nghost-%COMP%]   input.border-red-300[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   textarea.border-red-300[_ngcontent-%COMP%]:focus{border-color:#ef4444!important;box-shadow:0 0 0 3px #ef44441a!important}[_nghost-%COMP%]   input.bg-gray-100[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea.bg-gray-100[_ngcontent-%COMP%]{background-color:#f3f4f6!important;color:#6b7280!important;cursor:not-allowed!important}[_nghost-%COMP%]   input[_ngcontent-%COMP%]::placeholder, [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:#9ca3af!important;opacity:1!important}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']})}return n})();function Ce(n,l){return e=>!e.value||e.value.length===0?B(null):B(e.value).pipe(K(300),Q(i=>n.isNameUnique(i,l).pipe(Z(t=>t?null:{nameExists:{message:"El nombre de la categor\xEDa ya existe. Por favor, ingrese un nombre \xFAnico.",value:i}}),J(()=>(console.warn("Error checking category name uniqueness"),B(null))))))}var he=(()=>{class n{formBuilder=v(me);categoryService=v(W);alertService=v(j);viewContainerRef=v(q);categoryCreated=new O;nameValue=b("");descriptionValue=b("");isSubmitting=b(!1);isValidatingName=b(!1);categoryForm;constructor(){this.categoryForm=this.formBuilder.group({name:["",[$.required,$.maxLength(50)],[Ce(this.categoryService)]],description:["",[$.required,$.maxLength(90)]]}),this.alertService.setViewContainerRef(this.viewContainerRef)}updateName(e){this.nameValue.set(e);let i=this.categoryForm.get("name");i&&(this.isValidatingName.set(!0),i.setValue(e),i.markAsTouched(),i.statusChanges.subscribe(t=>{t!=="PENDING"&&this.isValidatingName.set(!1)}))}updateDescription(e){this.descriptionValue.set(e),this.categoryForm.get("description")?.setValue(e),this.categoryForm.get("description")?.markAsTouched()}getFieldErrors(e){let i=this.categoryForm.get(e);return!i?.errors||!i?.touched?[]:this.buildErrorMessages(e,i.errors)}buildErrorMessages(e,i){let t=[],s=e==="name",m=s?"El nombre de la categor\xEDa":"La descripci\xF3n",V=s?50:90;return i.required&&t.push(`${m} es requerido`),i.maxlength&&t.push(`${s?"El nombre":"La descripci\xF3n"} no puede exceder ${V} caracteres`),i.nameExists&&t.push("Ya existe una categor\xEDa con este nombre"),t}onSubmit(){return I(this,null,function*(){if(this.categoryForm.invalid){this.categoryForm.markAllAsTouched();return}this.isSubmitting.set(!0);try{let e=this.categoryForm.value,i={nombre:e.name.trim(),descripcion:e.description.trim()};yield k(this.categoryService.createCategory(i)),yield this.alertService.success("\xC9xito",`Categor\xEDa "${i.nombre}" creada exitosamente`),this.resetForm(),this.categoryCreated.emit()}catch(e){console.error("Error creating category:",e),yield this.alertService.error("Error","Error al crear la categor\xEDa. Por favor intenta nuevamente.")}finally{this.isSubmitting.set(!1)}})}resetForm(){this.categoryForm.reset(),this.nameValue.set(""),this.descriptionValue.set("")}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=w({type:n,selectors:[["app-category-form"]],outputs:{categoryCreated:"categoryCreated"},standalone:!0,features:[T],decls:9,vars:15,consts:[[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-xl","font-semibold","text-gray-900","mb-6"],[3,"ngSubmit","formGroup"],["label","Nombre de la Categor\xEDa","type","text","placeholder","Escribe el nombre de la categor\xEDa (m\xE1ximo 50 caracteres)",3,"valueChange","value","required","maxLength","errors","loading"],["label","Descripci\xF3n","type","textarea","placeholder","Enter category description",3,"valueChange","value","required","maxLength","rows","showCounter","errors"],[1,"flex","justify-end"],["variant","primary","type","submit",3,"disabled","loading"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"h2",1),c(2,"Crear Categor\xEDa"),o(),a(3,"form",2),g("ngSubmit",function(){return t.onSubmit()}),a(4,"app-input-field",3),g("valueChange",function(m){return t.updateName(m)}),o(),a(5,"app-input-field",4),g("valueChange",function(m){return t.updateDescription(m)}),o(),a(6,"div",5)(7,"app-button",6),c(8),o()()()()),i&2&&(r(3),p("formGroup",t.categoryForm),r(),p("value",t.nameValue())("required",!0)("maxLength",50)("errors",t.getFieldErrors("name"))("loading",t.isValidatingName()),r(),p("value",t.descriptionValue())("required",!0)("maxLength",90)("rows",5)("showCounter",!0)("errors",t.getFieldErrors("description")),r(2),p("disabled",t.categoryForm.invalid||t.isSubmitting())("loading",t.isSubmitting()),r(),_(" ",t.isSubmitting()?"Creando...":"Crear"," "))},dependencies:[P,ge,oe,ae,se,fe,ue],encapsulation:2})}return n})();var _e=(n,l)=>l.key,Oe=(n,l)=>l.id,Ve=(n,l)=>l.action;function Ie(n,l){if(n&1&&(a(0,"th"),c(1),o()),n&2){let e=l.$implicit,i=d();E(i.getHeaderClass(e)),r(),_(" ",e.label," ")}}function ke(n,l){n&1&&(a(0,"th",4),c(1," Acciones "),o())}function De(n,l){if(n&1&&(a(0,"td"),c(1),o()),n&2){let e=l.$implicit,i=d().$implicit,t=d();E(t.getCellClass(e)),r(),_(" ",t.getValue(i,e.key)," ")}}function Le(n,l){n&1&&(S(),y(0,"path",12))}function Ae(n,l){n&1&&(S(),y(0,"path",13))}function Ne(n,l){n&1&&(S(),y(0,"path",14)(1,"path",15))}function $e(n,l){if(n&1){let e=x();a(0,"button",10),g("click",function(){let t=C(e).$implicit,s=d(2).$implicit,m=d();return h(m.onAction(t.action,s))}),S(),a(1,"svg",11),u(2,Le,1,0,":svg:path",12)(3,Ae,1,0,":svg:path",13)(4,Ne,2,0),o()()}if(n&2){let e=l.$implicit,i=d(3);E(i.getActionClass(e)),p("title",e.label),r(2),f(e.icon==="delete"?2:-1),r(),f(e.icon==="edit"?3:-1),r(),f(e.icon==="view"?4:-1)}}function Be(n,l){if(n&1&&(a(0,"td",7)(1,"div",8),F(2,$e,5,6,"button",9,Ve),o()()),n&2){let e=d(2);r(2),M(e.actions)}}function qe(n,l){if(n&1&&(a(0,"tr",6),F(1,De,2,3,"td",3,_e),u(3,Be,4,0,"td",7),o()),n&2){let e=d();r(),M(e.columns),r(2),f(e.actions.length>0?3:-1)}}function ze(n,l){if(n&1&&(a(0,"tr")(1,"td",16),c(2),o()()),n&2){let e=d();r(),D("colspan",e.getColspan()),r(),_(" ",e.emptyMessage," ")}}var xe=(()=>{class n{columns=[];data=[];actions=[];emptyMessage="No hay datos disponibles";actionClick=new O;getHeaderClass(e){let i="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",t=`text-${e.align||"left"}`;return`${i} ${t}`}getCellClass(e){let i="px-6 py-4 whitespace-nowrap text-sm",t=`text-${e.align||"left"}`;return`${i} ${t}`}getActionClass(e){return`inline-flex items-center p-2 rounded-lg transition-colors ${{red:"text-red-600 hover:text-red-800 hover:bg-red-50",blue:"text-blue-600 hover:text-blue-800 hover:bg-blue-50",green:"text-green-600 hover:text-green-800 hover:bg-green-50",gray:"text-gray-600 hover:text-gray-800 hover:bg-gray-50"}[e.color]}`}getValue(e,i){let t=i.split("."),s=e;for(let m of t)s=s?.[m];return s||""}getColspan(){return this.columns.length+(this.actions.length>0?1:0)}onAction(e,i){this.actionClick.emit({action:e,item:i})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=w({type:n,selectors:[["app-data-table"]],inputs:{columns:"columns",data:"data",actions:"actions",emptyMessage:"emptyMessage"},outputs:{actionClick:"actionClick"},standalone:!0,features:[T],decls:11,vars:2,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"w-full"],[1,"bg-gray-50"],[3,"class"],[1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],[1,"flex","justify-end","space-x-2"],[3,"class","title"],[3,"click","title"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],["d","M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"],["d","M10 12a2 2 0 100-4 2 2 0 000 4z"],["fill-rule","evenodd","d","M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule","evenodd"],[1,"px-6","py-8","text-center","text-gray-500"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"table",1)(2,"thead",2)(3,"tr"),F(4,Ie,2,3,"th",3,_e),u(6,ke,2,0,"th",4),o()(),a(7,"tbody",5),F(8,qe,4,1,"tr",6,Oe,!1,ze,3,2,"tr"),o()()()),i&2&&(r(4),M(t.columns),r(2),f(t.actions.length>0?6:-1),r(2),M(t.data))},dependencies:[P],encapsulation:2})}return n})();function Ge(n,l){n&1&&c(0," ... ")}function Re(n,l){if(n&1&&c(0),n&2){let e=d().$implicit;_(" ",e," ")}}function We(n,l){if(n&1){let e=x();a(0,"button",4),g("click",function(){let t=C(e).$implicit,s=d(2);return h(s.goToPage(t))}),u(1,Ge,1,0)(2,Re,1,1),o()}if(n&2){let e=l.$implicit,i=d(2);E(i.getPageButtonClass(e)),p("disabled",e===-1),r(),f(e===-1?1:2)}}function je(n,l){if(n&1){let e=x();a(0,"button",5),g("click",function(){C(e);let t=d(2);return h(t.goToPage(t.currentPage+1))}),S(),a(1,"svg",6),y(2,"path",7),o()()}}function He(n,l){if(n&1&&(a(0,"nav",0)(1,"div",1),F(2,We,3,4,"button",2,z),u(4,je,3,0,"button",3),o()()),n&2){let e=d();r(2),M(e.getPaginationArray()),r(2),f(e.currentPage<e.totalPages?4:-1)}}var be=(()=>{class n{currentPage=1;totalPages=1;maxVisiblePages=5;pageChange=new O;getPaginationArray(){let e=this.totalPages,i=this.currentPage,t=Math.floor(this.maxVisiblePages/2),s=[],m=[];for(let V=Math.max(2,i-t);V<=Math.min(e-1,i+t);V++)s.push(V);return i-t>2?m.push(1,-1):m.push(1),m.push(...s),i+t<e-1?m.push(-1,e):e>1&&m.push(e),m}getPageButtonClass(e){let i="px-4 py-2 rounded-lg";return e===-1?`${i} bg-white text-gray-400 cursor-default`:e===this.currentPage?`${i} bg-blue-600 text-white`:`${i} bg-white text-gray-700 border border-gray-300 hover:bg-gray-50`}goToPage(e){e>=1&&e<=this.totalPages&&e!==this.currentPage&&e!==-1&&this.pageChange.emit(e)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=w({type:n,selectors:[["app-pagination"]],inputs:{currentPage:"currentPage",totalPages:"totalPages",maxVisiblePages:"maxVisiblePages"},outputs:{pageChange:"pageChange"},standalone:!0,features:[T],decls:1,vars:1,consts:[[1,"flex","justify-center","mt-6"],[1,"flex","space-x-1"],[3,"disabled","class"],[1,"px-3","py-2","bg-white","text-gray-700","border","border-gray-300","rounded-lg","hover:bg-gray-50"],[3,"click","disabled"],[1,"px-3","py-2","bg-white","text-gray-700","border","border-gray-300","rounded-lg","hover:bg-gray-50",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["fill-rule","evenodd","d","M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule","evenodd"]],template:function(i,t){i&1&&u(0,He,5,1,"nav",0),i&2&&f(t.totalPages>1?0:-1)},dependencies:[P],encapsulation:2})}return n})();function Ue(n,l){if(n&1){let e=x();a(0,"div",30)(1,"app-category-form",31),g("categoryCreated",function(){C(e);let t=d();return h(t.onCategoryCreated())}),o()()}}function Ye(n,l){if(n&1){let e=x();a(0,"div",17)(1,"label",32),c(2,"Estado:"),o(),a(3,"select",33),N("ngModelChange",function(t){C(e);let s=d();return A(s.filterOptions.activeOnly,t)||(s.filterOptions.activeOnly=t),h(t)}),g("change",function(){C(e);let t=d();return h(t.onFilterChange())}),a(4,"option",34),c(5,"Solo activas"),o(),a(6,"option",34),c(7,"Todas"),o()()()}if(n&2){let e=d();r(3),L("ngModel",e.filterOptions.activeOnly),r(),p("value",!0),r(2),p("value",!1)}}function Ze(n,l){n&1&&(a(0,"div",35)(1,"div",36),S(),a(2,"svg",37),y(3,"circle",38)(4,"path",39),o(),U(),a(5,"span",5),c(6,"Cargando categor\xEDas..."),o()()())}function Je(n,l){if(n&1&&(a(0,"span",45),c(1),o()),n&2){let e=d(2);r(),_(' \u2022 Filtradas por: "',e.filterOptions.searchText,'" ')}}function Ke(n,l){if(n&1){let e=x();a(0,"div")(1,"app-data-table",40),g("actionClick",function(t){C(e);let s=d();return h(s.onTableAction(t))}),o(),a(2,"div",41)(3,"div",42),c(4),u(5,Je,2,1,"span",43),o(),a(6,"app-pagination",44),g("pageChange",function(t){C(e);let s=d();return h(s.onPageChange(t))}),o()()()}if(n&2){let e=d();r(),p("columns",e.getTableColumns())("data",e.paginatedCategories())("actions",e.getTableActions())("emptyMessage",e.getEmptyMessage()),r(3),X(" Mostrando ",e.getStartIndex()+1," - ",e.getEndIndex()," de ",e.getTotalFilteredItems()," categor\xEDas "),r(),p("ngIf",e.filterOptions.searchText),r(),p("currentPage",e.currentPage())("totalPages",e.getTotalPages())("maxVisiblePages",5)}}var Ht=(()=>{class n{categoryService=v(W);alertService=v(j);authFacade=v(ee);viewContainerRef=v(q);categories=b([]);filteredCategories=b([]);currentPage=b(1);totalPages=b(1);isLoading=b(!1);itemsPerPage=10;filterOptions={activeOnly:!0,sortOrder:"asc",sortBy:"nombre",searchText:""};adminTableColumns=[{key:"id",label:"ID",width:"w-20"},{key:"nombre",label:"Nombre",width:"w-48"},{key:"descripcion",label:"Descripci\xF3n",width:"flex-1"},{key:"fechaCreacion",label:"Fecha de creaci\xF3n",width:"w-32"},{key:"activo",label:"Estado",width:"w-20"}];userTableColumns=[{key:"nombre",label:"Nombre",width:"w-48"},{key:"descripcion",label:"Descripci\xF3n",width:"flex-1"},{key:"fechaCreacion",label:"Fecha de creaci\xF3n",width:"w-32"}];adminTableActions=[{icon:"delete",label:"Eliminar categor\xEDa",color:"red",action:"delete"}];constructor(){this.alertService.setViewContainerRef(this.viewContainerRef)}ngOnInit(){this.loadCategories(),this.setupFiltersForRole()}isAdmin(){return this.authFacade.getCurrentUser()?.role===te.ADMIN}setupFiltersForRole(){this.isAdmin()||(this.filterOptions.activeOnly=!0)}getTableColumns(){return this.isAdmin()?this.adminTableColumns:this.userTableColumns}getTableActions(){return this.isAdmin()?this.adminTableActions:[]}loadCategories(){return I(this,null,function*(){this.isLoading.set(!0);try{let e=yield k(this.categoryService.getCategories());this.categories.set(e),this.applyFilters()}catch(e){console.error("Error loading categories:",e),yield this.alertService.error("Error","Error al cargar las categor\xEDas")}finally{this.isLoading.set(!1)}})}applyFilters(){let e=[...this.categories()];if((!this.isAdmin()||this.filterOptions.activeOnly)&&(e=e.filter(i=>i.activo)),this.filterOptions.searchText.trim()){let i=this.filterOptions.searchText.toLowerCase().trim();e=e.filter(t=>t.nombre.toLowerCase().includes(i)||t.descripcion.toLowerCase().includes(i))}e.sort((i,t)=>{let s=0;switch(this.filterOptions.sortBy){case"nombre":s=i.nombre.localeCompare(t.nombre);break;case"descripcion":s=i.descripcion.localeCompare(t.descripcion);break;case"fechaCreacion":s=new Date(i.fechaCreacion).getTime()-new Date(t.fechaCreacion).getTime();break}return this.filterOptions.sortOrder==="asc"?s:-s}),this.filteredCategories.set(e),this.updatePagination()}onFilterChange(){this.currentPage.set(1),this.applyFilters()}clearFilters(){this.filterOptions={activeOnly:!0,sortOrder:"asc",sortBy:"nombre",searchText:""},this.onFilterChange()}onCategoryCreated(){this.loadCategories()}onTableAction(e){return I(this,null,function*(){if(!this.isAdmin()){yield this.alertService.warning("Acceso denegado","No tienes permisos para realizar esta acci\xF3n");return}e.action==="delete"&&(yield this.deleteCategory(e.item))})}deleteCategory(e){return I(this,null,function*(){if(!this.isAdmin()){yield this.alertService.error("Acceso denegado","Solo los administradores pueden eliminar categor\xEDas");return}if(yield this.alertService.confirm("Confirmar eliminaci\xF3n",`\xBFEst\xE1s seguro de que deseas eliminar la categor\xEDa "${e.nombre}"?`,"Eliminar","Cancelar"))try{yield k(this.categoryService.deleteCategory(e.id)),yield this.alertService.success("\xC9xito",`Categor\xEDa "${e.nombre}" eliminada exitosamente`),yield this.loadCategories()}catch(t){console.error("Error deleting category:",t),yield this.alertService.error("Error","Error al eliminar la categor\xEDa. Por favor intenta nuevamente.")}})}onPageChange(e){this.currentPage.set(e)}paginatedCategories(){let e=(this.currentPage()-1)*this.itemsPerPage,i=e+this.itemsPerPage;return this.filteredCategories().slice(e,i)}updatePagination(){let e=this.filteredCategories().length;this.totalPages.set(Math.ceil(e/this.itemsPerPage)),this.currentPage()>this.totalPages()&&this.currentPage.set(1)}getTotalPages(){return this.totalPages()}getTotalFilteredItems(){return this.filteredCategories().length}getStartIndex(){return(this.currentPage()-1)*this.itemsPerPage}getEndIndex(){let e=this.getStartIndex()+this.itemsPerPage;return Math.min(e,this.getTotalFilteredItems())}getEmptyMessage(){return this.filterOptions.searchText.trim()?`No se encontraron categor\xEDas que coincidan con "${this.filterOptions.searchText}"`:this.isAdmin()&&!this.filterOptions.activeOnly?"No hay categor\xEDas registradas en el sistema":this.isAdmin()?"No hay categor\xEDas activas registradas":"No hay categor\xEDas disponibles en este momento"}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=w({type:n,selectors:[["app-categorias"]],standalone:!0,features:[T],decls:43,vars:12,consts:[[1,"min-h-screen","bg-gray-50"],[1,"p-6"],[1,"max-w-7xl","mx-auto"],[1,"bg-white","rounded-lg","shadow-sm","p-6","mb-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],["class","mb-6",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"flex","flex-col","lg:flex-row","lg:justify-between","lg:items-center","gap-4","mb-6"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","font-normal","text-gray-500","ml-2"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"relative"],["type","text","placeholder","Buscar categor\xEDas...",1,"pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","text-sm","w-64",3,"ngModelChange","input","ngModel"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"absolute","left-3","top-2.5","h-4","w-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],["for","sort-by",1,"text-sm","font-medium","text-gray-700"],["id","sort-by",1,"border","border-gray-300","rounded-lg","px-3","py-2","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","change","ngModel"],["value","nombre"],["value","descripcion"],["value","fechaCreacion"],["for","sort-order",1,"text-sm","font-medium","text-gray-700"],["id","sort-order",1,"border","border-gray-300","rounded-lg","px-3","py-2","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","change","ngModel"],["value","asc"],["value","desc"],[1,"px-3","py-2","text-sm","text-gray-600","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],["class","flex justify-center items-center py-12",4,"ngIf"],[4,"ngIf"],[1,"mb-6"],[3,"categoryCreated"],["for","status-filter",1,"text-sm","font-medium","text-gray-700"],["id","status-filter",1,"border","border-gray-300","rounded-lg","px-3","py-2","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","change","ngModel"],[3,"value"],[1,"flex","justify-center","items-center","py-12"],[1,"flex","items-center","space-x-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-500"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[3,"actionClick","columns","data","actions","emptyMessage"],[1,"mt-6","flex","flex-col","sm:flex-row","sm:justify-between","sm:items-center","gap-4"],[1,"text-sm","text-gray-600"],["class","ml-2 text-blue-600",4,"ngIf"],[3,"pageChange","currentPage","totalPages","maxVisiblePages"],[1,"ml-2","text-blue-600"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"main",1)(2,"div",2)(3,"div",3)(4,"h1",4),c(5),o(),a(6,"p",5),c(7),o()(),u(8,Ue,2,0,"div",6),a(9,"div",7)(10,"div",8)(11,"h2",9),c(12),a(13,"span",10),c(14),o()(),a(15,"div",11)(16,"div",12)(17,"input",13),N("ngModelChange",function(m){return A(t.filterOptions.searchText,m)||(t.filterOptions.searchText=m),m}),g("input",function(){return t.onFilterChange()}),o(),S(),a(18,"svg",14),y(19,"path",15),o()(),u(20,Ye,8,3,"div",16),U(),a(21,"div",17)(22,"label",18),c(23,"Ordenar por:"),o(),a(24,"select",19),N("ngModelChange",function(m){return A(t.filterOptions.sortBy,m)||(t.filterOptions.sortBy=m),m}),g("change",function(){return t.onFilterChange()}),a(25,"option",20),c(26,"Nombre"),o(),a(27,"option",21),c(28,"Descripci\xF3n"),o(),a(29,"option",22),c(30,"Fecha de creaci\xF3n"),o()()(),a(31,"div",17)(32,"label",23),c(33,"Orden:"),o(),a(34,"select",24),N("ngModelChange",function(m){return A(t.filterOptions.sortOrder,m)||(t.filterOptions.sortOrder=m),m}),g("change",function(){return t.onFilterChange()}),a(35,"option",25),c(36,"Ascendente"),o(),a(37,"option",26),c(38,"Descendente"),o()()(),a(39,"button",27),g("click",function(){return t.clearFilters()}),c(40," Limpiar filtros "),o()()(),u(41,Ze,7,0,"div",28)(42,Ke,7,11,"div",29),o()()()()),i&2&&(r(5),_(" ",t.isAdmin()?"Gesti\xF3n de Categor\xEDas":"Categor\xEDas de Inmuebles"," "),r(2),_(" ",t.isAdmin()?"Crear y administrar categor\xEDas de inmuebles":"Consulta las categor\xEDas disponibles para propiedades"," "),r(),p("ngIf",t.isAdmin()),r(4),_(" ",t.isAdmin()?"Categor\xEDas Registradas":"Categor\xEDas Disponibles"," "),r(2),G(" (",t.getTotalFilteredItems()," ",t.getTotalFilteredItems()===1?"categor\xEDa":"categor\xEDas",") "),r(3),L("ngModel",t.filterOptions.searchText),r(3),p("ngIf",t.isAdmin()),r(4),L("ngModel",t.filterOptions.sortBy),r(10),L("ngModel",t.filterOptions.sortOrder),r(7),p("ngIf",t.isLoading()),r(),p("ngIf",!t.isLoading()))},dependencies:[P,R,pe,ce,de,ne,le,ie,re,he,xe,be],encapsulation:2})}return n})();export{Ht as CategoriasComponent};
