import{a as W}from"./chunk-DWWM3IXI.js";import{a as Q}from"./chunk-FZJGQSSN.js";import"./chunk-OATTNESZ.js";import{b as $,d as H,e as O,h as z,j as G,k as j,l as B,m as R,n as q,s as J,u as K}from"./chunk-46JGFRV7.js";import{b as w}from"./chunk-STP3WM4P.js";import{x as U}from"./chunk-3KOIEGY5.js";import{h as A}from"./chunk-BZNYC5N3.js";import"./chunk-XOLXN3IC.js";import{Ab as L,Ac as N,Bb as S,Ca as h,Cb as y,Da as b,Db as i,Ea as _,Eb as t,Fa as v,Fb as m,Gb as C,Hb as p,Ib as d,Mb as r,Nb as D,Ob as g,Pb as T,Vb as M,hb as s,ic as k,na as f,nb as u,sb as E,ta as P,vb as x,yb as I,zb as F}from"./chunk-PHL42RAN.js";var X=(n,l)=>l.id;function Z(n,l){if(n&1&&(i(0,"option",14),r(1),t()),n&2){let e=l.$implicit;x("value",e.id),s(),T("",e.ciudad,", ",e.departamento,"")}}function ee(n,l){if(n&1){let e=C();i(0,"button",33),p("click",function(){h(e);let a=d().$implicit,c=d();return b(c.goToScheduleVisit(a.id))}),r(1," Agendar Visita "),t()}}function te(n,l){n&1&&(i(0,"button",32),r(1," Sin espacios disponibles "),t())}function ie(n,l){if(n&1&&(i(0,"div",18)(1,"div",21)(2,"h3",22),r(3),t(),i(4,"span",23),r(5),t()(),i(6,"div",24)(7,"div",25),_(),i(8,"svg",26),m(9,"path",27)(10,"path",28),t(),r(11),t(),v(),i(12,"div",25),_(),i(13,"svg",26),m(14,"path",29),t(),r(15),t(),v(),i(16,"div",25),_(),i(17,"svg",26),m(18,"path",29),t(),r(19),t(),v(),i(20,"div",30),r(21),t()(),E(22,ee,2,0,"button",31)(23,te,2,0,"button",32),t()),n&2){let e=l.$implicit,o=d();s(3),D(e.casa.nombre),s(2),g("",e.espaciosDisponibles," espacios"),s(6),T(" ",e.casa.ubicacion.ciudad,", ",e.casa.ubicacion.departamento," "),s(4),g(" ",o.formatDateTime(e.fechaHoraInicio)," "),s(4),g(" ",o.formatDateTime(e.fechaHoraFin)," "),s(2),g(" ",o.formatPrice(e.casa.precio)," "),s(),F(e.espaciosDisponibles>0?22:23)}}function ne(n,l){n&1&&(i(0,"div",19)(1,"p",34),r(2,"No hay horarios disponibles con los filtros seleccionados."),t()())}function oe(n,l){if(n&1){let e=C();i(0,"button",38),p("click",function(){let a=h(e).$implicit,c=d(2);return b(c.goToPage(a))}),r(1),t()}if(n&2){let e=l.$implicit,o=d(2);I(e===o.currentPage()?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),s(),g(" ",e," ")}}function re(n,l){if(n&1){let e=C();i(0,"div",20)(1,"nav",35)(2,"button",36),p("click",function(){h(e);let a=d();return b(a.goToPage(a.currentPage()-1))}),r(3," Anterior "),t(),S(4,oe,2,3,"button",37,L),i(6,"button",36),p("click",function(){h(e);let a=d();return b(a.goToPage(a.currentPage()+1))}),r(7," Siguiente "),t()()()}if(n&2){let e=d();s(2),x("disabled",e.currentPage()===1),s(2),y(e.getPages()),s(2),x("disabled",e.currentPage()===e.totalPages())}}var be=(()=>{class n{visitService=f(W);ubicacionService=f(Q);formBuilder=f(J);authFacade=f(U);schedules=u([]);ubicaciones=u([]);loading=u(!1);currentPage=u(1);pageSize=u(9);filterForm=this.formBuilder.group({fechaInicio:[""],fechaFin:[""],ubicacionId:[""]});totalPages=k(()=>Math.ceil(this.schedules().length/this.pageSize()));paginatedSchedules=k(()=>{let e=(this.currentPage()-1)*this.pageSize(),o=e+this.pageSize();return this.schedules().slice(e,o)});ngOnInit(){this.loadUbicaciones(),this.loadAvailableSchedules()}isAdmin(){return this.authFacade.getCurrentUser()?.role===w.ADMIN}isVendedor(){return this.authFacade.getCurrentUser()?.role===w.VENDEDOR}isComprador(){return this.authFacade.getCurrentUser()?.role===w.COMPRADOR}loadUbicaciones(){this.ubicacionService.searchUbicaciones().subscribe({next:e=>this.ubicaciones.set(e.data||[]),error:e=>console.error("Error loading ubicaciones:",e)})}loadAvailableSchedules(){this.loading.set(!0);let e=this.filterForm.value;this.visitService.getAvailableSchedules(e).subscribe({next:o=>{let a=o.filter(c=>new Date(c.fechaHoraInicio)>new Date&&c.espaciosDisponibles>0);this.schedules.set(a),this.loading.set(!1)},error:o=>{console.error("Error loading schedules:",o),this.loading.set(!1)}})}applyFilters(){this.currentPage.set(1),this.loadAvailableSchedules()}goToPage(e){e>=1&&e<=this.totalPages()&&this.currentPage.set(e)}getPages(){let e=this.totalPages(),o=this.currentPage(),a=[],c=Math.max(1,o-2),Y=Math.min(e,o+2);for(let V=c;V<=Y;V++)a.push(V);return a}formatDateTime(e){return new Date(e).toLocaleString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatPrice(e){return e?`$${e.toLocaleString("es-CO")}`:"$0"}goToScheduleVisit(e){window.location.href=`/comprador/agendar-visita?scheduleId=${e}`}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=P({type:n,selectors:[["app-visit-schedules-listing"]],standalone:!0,features:[M],decls:33,vars:3,consts:[[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"mb-8",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],["for","fechaInicio",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","datetime-local","id","fechaInicio","formControlName","fechaInicio",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","fechaFin",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","datetime-local","id","fechaFin","formControlName","fechaFin",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","ubicacionId",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","ubicacionId","formControlName","ubicacionId",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["value",""],[3,"value"],[1,"flex","items-end"],["type","submit",1,"w-full","bg-blue-600","text-white","py-2","px-4","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"border","border-gray-200","rounded-lg","p-4","hover:shadow-md","transition-shadow"],[1,"col-span-full","text-center","py-8"],[1,"mt-8","flex","justify-center"],[1,"flex","justify-between","items-start","mb-2"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"space-y-2","text-sm","text-gray-600"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-semibold","text-green-600"],[1,"w-full","mt-4","bg-green-600","text-white","py-2","px-4","rounded-md","hover:bg-green-700","focus:outline-none","focus:ring-2","focus:ring-green-500"],["disabled","",1,"w-full","mt-4","bg-gray-400","text-white","py-2","px-4","rounded-md","cursor-not-allowed"],[1,"w-full","mt-4","bg-green-600","text-white","py-2","px-4","rounded-md","hover:bg-green-700","focus:outline-none","focus:ring-2","focus:ring-green-500",3,"click"],[1,"text-gray-500"],[1,"flex","space-x-2"],[1,"px-3","py-2","border","border-gray-300","rounded-md","text-sm","font-medium","text-gray-700","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-3","py-2","border","border-gray-300","rounded-md","text-sm","font-medium",3,"class"],[1,"px-3","py-2","border","border-gray-300","rounded-md","text-sm","font-medium",3,"click"]],template:function(o,a){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4," Horarios de Visitas Disponibles - HU #10 "),t(),i(5,"p",4),r(6," Todos los roles pueden ver y filtrar horarios de visitas disponibles "),t(),i(7,"form",5),p("ngSubmit",function(){return a.applyFilters()}),i(8,"div",6)(9,"div")(10,"label",7),r(11," Fecha Inicio "),t(),m(12,"input",8),t(),i(13,"div")(14,"label",9),r(15," Fecha Fin "),t(),m(16,"input",10),t(),i(17,"div")(18,"label",11),r(19," Ubicaci\xF3n "),t(),i(20,"select",12)(21,"option",13),r(22,"Todas las ubicaciones"),t(),S(23,Z,2,3,"option",14,X),t()(),i(25,"div",15)(26,"button",16),r(27," Buscar "),t()()()(),i(28,"div",17),S(29,ie,24,8,"div",18,X,!1,ne,3,0,"div",19),t(),E(32,re,8,2,"div",20),t()()()),o&2&&(s(7),x("formGroup",a.filterForm),s(16),y(a.ubicaciones()),s(6),y(a.paginatedSchedules()),s(3),F(a.totalPages()>1?32:-1))},dependencies:[N,K,z,R,q,$,B,H,O,G,j,A],encapsulation:2})}return n})();export{be as VisitSchedulesListingComponent};
