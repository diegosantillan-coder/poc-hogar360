import{a as ne}from"./chunk-FXWIRNBA.js";import{a as ae}from"./chunk-FTOEQC3Z.js";import{a as re}from"./chunk-IHQ7T7HL.js";import{a as oe}from"./chunk-FZJGQSSN.js";import"./chunk-OATTNESZ.js";import{b as G,c as u,d as H,e as j,h as z,i as Z,j as J,k as K,l as Q,m as W,n as X,o as Y,p as ee,s as te,u as ie}from"./chunk-46JGFRV7.js";import{a as _,b as A}from"./chunk-STP3WM4P.js";import{x as $}from"./chunk-3KOIEGY5.js";import{Ac as B,Bb as P,Ca as y,Cb as E,Da as v,Db as r,Eb as o,Fb as C,Gb as w,Hb as b,Ib as s,Mb as i,Nb as N,Ob as S,Pb as F,Vb as L,Wb as R,Yb as k,f as V,hb as a,mb as O,na as x,nb as f,sb as m,ta as U,vb as h,yb as q,zb as c,zc as M}from"./chunk-PHL42RAN.js";var I=(t,n)=>n.id;function de(t,n){t&1&&i(0," Gesti\xF3n de Propiedades ")}function le(t,n){t&1&&i(0," Propiedades Disponibles ")}function ce(t,n){t&1&&i(0," Cancelar ")}function se(t,n){t&1&&i(0," Nueva Propiedad ")}function pe(t,n){if(t&1){let e=w();r(0,"button",13),b("click",function(){y(e);let d=s();return v(d.toggleForm())}),m(1,ce,1,0)(2,se,1,0),o()}if(t&2){let e=s();a(),c(e.showForm()?1:2)}}function me(t,n){t&1&&i(0," Editar Propiedad ")}function ue(t,n){t&1&&i(0," Publicar Nueva Propiedad - HU #6 ")}function _e(t,n){if(t&1&&(r(0,"option",22),i(1),o()),t&2){let e=n.$implicit;h("value",e.id),a(),N(e.nombre)}}function xe(t,n){if(t&1&&(r(0,"option",22),i(1),o()),t&2){let e=n.$implicit;h("value",e.id),a(),F("",e.ciudad,", ",e.departamento,"")}}function fe(t,n){t&1&&i(0," Guardando... ")}function Ce(t,n){t&1&&i(0," Actualizar ")}function be(t,n){t&1&&i(0," Crear Propiedad ")}function ge(t,n){t&1&&(r(0,"li"),i(1,"\u2022 El nombre es requerido"),o())}function ye(t,n){t&1&&(r(0,"li"),i(1,"\u2022 La descripci\xF3n es requerida"),o())}function ve(t,n){t&1&&(r(0,"li"),i(1,"\u2022 La categor\xEDa es requerida"),o())}function he(t,n){t&1&&(r(0,"li"),i(1,"\u2022 La ubicaci\xF3n es requerida"),o())}function Se(t,n){t&1&&(r(0,"li"),i(1,"\u2022 El precio es requerido"),o())}function Pe(t,n){t&1&&(r(0,"li"),i(1,"\u2022 La fecha de publicaci\xF3n activa es requerida"),o())}function Ee(t,n){if(t&1&&(r(0,"div",39)(1,"h3",40),i(2,"Errores en el formulario:"),o(),r(3,"ul",41),m(4,ge,2,0,"li")(5,ye,2,0,"li")(6,ve,2,0,"li")(7,he,2,0,"li")(8,Se,2,0,"li")(9,Pe,2,0,"li"),o()()),t&2){let e,l,d,p,D,T,g=s(2);a(4),c(!((e=g.propertyForm.get("nombre"))==null||e.errors==null)&&e.errors.required?4:-1),a(),c(!((l=g.propertyForm.get("descripcion"))==null||l.errors==null)&&l.errors.required?5:-1),a(),c(!((d=g.propertyForm.get("categoria_id"))==null||d.errors==null)&&d.errors.required?6:-1),a(),c(!((p=g.propertyForm.get("ubicacion_id"))==null||p.errors==null)&&p.errors.required?7:-1),a(),c(!((D=g.propertyForm.get("precio"))==null||D.errors==null)&&D.errors.required?8:-1),a(),c(!((T=g.propertyForm.get("fecha_publicacion_activa"))==null||T.errors==null)&&T.errors.required?9:-1)}}function we(t,n){if(t&1){let e=w();r(0,"div",6)(1,"h2",14),m(2,me,1,0)(3,ue,1,0),o(),r(4,"form",15),b("ngSubmit",function(){y(e);let d=s();return v(d.onSubmit())}),r(5,"div",16)(6,"div")(7,"label",17),i(8," Nombre de la Propiedad "),r(9,"span",18),i(10,"*"),o()(),C(11,"input",19),o(),r(12,"div")(13,"label",17),i(14," Categor\xEDa "),r(15,"span",18),i(16,"*"),o()(),r(17,"select",20)(18,"option",21),i(19,"Selecciona una categor\xEDa"),o(),P(20,_e,2,2,"option",22,I),o()()(),r(22,"div")(23,"label",17),i(24," Descripci\xF3n "),r(25,"span",18),i(26,"*"),o()(),r(27,"textarea",23),i(28,"              "),o()(),r(29,"div",24)(30,"div")(31,"label",17),i(32," N\xFAmero de Cuartos "),r(33,"span",18),i(34,"*"),o()(),C(35,"input",25),o(),r(36,"div")(37,"label",17),i(38," N\xFAmero de Ba\xF1os "),r(39,"span",18),i(40,"*"),o()(),C(41,"input",26),o(),r(42,"div")(43,"label",17),i(44," Precio (COP) "),r(45,"span",18),i(46,"*"),o()(),C(47,"input",27),o()(),r(48,"div",16)(49,"div")(50,"label",17),i(51," Ubicaci\xF3n "),r(52,"span",18),i(53,"*"),o()(),r(54,"select",28)(55,"option",21),i(56,"Selecciona una ubicaci\xF3n"),o(),P(57,xe,2,3,"option",22,I),o()(),r(59,"div")(60,"label",17),i(61," Fecha de Publicaci\xF3n Activa "),r(62,"span",18),i(63,"*"),o()(),C(64,"input",29),r(65,"p",30),i(66,"M\xE1ximo 1 mes desde hoy"),o()()(),r(67,"div")(68,"label",17),i(69," Estado de Publicaci\xF3n "),r(70,"span",18),i(71,"*"),o()(),r(72,"select",31)(73,"option",32),i(74,"Publicada"),o(),r(75,"option",33),i(76,"Publicaci\xF3n Pausada"),o(),r(77,"option",34),i(78,"Transacci\xF3n en Curso"),o(),r(79,"option",35),i(80,"Transacci\xF3n Finalizada"),o()()(),r(81,"div",36)(82,"button",37),b("click",function(){y(e);let d=s();return v(d.resetForm())}),i(83," Limpiar "),o(),r(84,"button",38),m(85,fe,1,0)(86,Ce,1,0)(87,be,1,0),o()()(),m(88,Ee,10,6,"div",39),o()}if(t&2){let e=s();a(2),c(e.editingProperty()?2:3),a(2),h("formGroup",e.propertyForm),a(16),E(e.categorias()),a(37),E(e.ubicaciones()),a(7),h("min",e.today)("max",e.maxDate),a(20),h("disabled",e.propertyForm.invalid||e.isSubmitting()),a(),c(e.isSubmitting()?85:e.editingProperty()?86:87),a(3),c(e.propertyForm.invalid&&e.propertyForm.touched?88:-1)}}function Fe(t,n){if(t&1&&i(0),t&2){let e=s();S(" Mis Propiedades (",e.properties().length,") ")}}function Ae(t,n){if(t&1&&i(0),t&2){let e=s();S(" Propiedades Disponibles - HU #7 (",e.properties().length,") ")}}function De(t,n){t&1&&(r(0,"div",10),C(1,"div",42),r(2,"p",43),i(3,"Cargando propiedades..."),o()())}function Te(t,n){t&1&&i(0," No tienes propiedades registradas. ")}function Ne(t,n){t&1&&i(0," No hay propiedades disponibles en este momento. ")}function Ie(t,n){if(t&1&&(r(0,"div",11),m(1,Te,1,0)(2,Ne,1,0),o()),t&2){let e=s();a(),c(e.isVendedor()?1:2)}}function Ve(t,n){if(t&1){let e=w();r(0,"button",55),b("click",function(){y(e);let d=s().$implicit,p=s(2);return v(p.editProperty(d))}),i(1," Editar "),o(),r(2,"button",56),b("click",function(){y(e);let d=s().$implicit,p=s(2);return v(p.deleteProperty(d.id))}),i(3," Eliminar "),o()}}function Ue(t,n){t&1&&(r(0,"button",57),i(1," Ver Detalles "),o(),r(2,"button",58),i(3," Agendar Visita "),o())}function Oe(t,n){if(t&1&&(r(0,"tr",48)(1,"td",49)(2,"div")(3,"div",50),i(4),o(),r(5,"div",51),i(6),o()()(),r(7,"td",52),i(8),o(),r(9,"td",52),i(10),o(),r(11,"td",52),i(12),R(13,"currency"),o(),r(14,"td",49)(15,"span",53),i(16),o()(),r(17,"td",54),m(18,Ve,4,0)(19,Ue,4,0),o()()),t&2){let e=n.$implicit,l=s(2);a(4),N(e.nombre),a(2),F("",e.cantidad_cuartos," cuartos, ",e.cantidad_banos," ba\xF1os"),a(2),S(" ",e.categoria.nombre," "),a(2),F(" ",e.ubicacion.ciudad,", ",e.ubicacion.departamento," "),a(2),S(" ",k(13,11,e.precio,"COP","symbol","1.0-0")," "),a(3),q(l.getStatusClass(e.estado_publicacion)),a(),S(" ",l.getStatusText(e.estado_publicacion)," "),a(2),c(l.isVendedor()?18:19)}}function qe(t,n){if(t&1&&(r(0,"div",12)(1,"table",44)(2,"thead",45)(3,"tr")(4,"th",46),i(5," Propiedad "),o(),r(6,"th",46),i(7," Categor\xEDa "),o(),r(8,"th",46),i(9," Ubicaci\xF3n "),o(),r(10,"th",46),i(11," Precio "),o(),r(12,"th",46),i(13," Estado "),o(),r(14,"th",46),i(15," Acciones "),o()()(),r(16,"tbody",47),P(17,Oe,20,16,"tr",48,I),o()()()),t&2){let e=s();a(17),E(e.properties())}}var Xe=(()=>{class t{fb=x(te);propertyService=x(re);categoryService=x(ne);ubicacionService=x(oe);alertService=x(ae);viewContainerRef=x(O);authFacade=x($);showForm=f(!1);isSubmitting=f(!1);isLoading=f(!1);editingProperty=f(null);properties=f([]);categorias=f([]);ubicaciones=f([]);today=new Date().toISOString().slice(0,16);maxDate=new Date(Date.now()+30*24*60*60*1e3).toISOString().slice(0,16);propertyForm=this.fb.group({nombre:["",[u.required]],descripcion:["",[u.required]],categoria_id:["",[u.required]],cantidad_cuartos:[1,[u.required,u.min(1)]],cantidad_banos:[1,[u.required,u.min(1)]],precio:["",[u.required,u.min(1)]],ubicacion_id:["",[u.required]],fecha_publicacion_activa:["",[u.required]],estado_publicacion:["PUBLICADA",[u.required]]});ngOnInit(){this.alertService.setViewContainerRef(this.viewContainerRef),this.loadCategorias(),this.loadUbicaciones(),setTimeout(()=>{this.ubicaciones().length===0&&(console.warn("No ubicaciones loaded from service, loading directly..."),this.loadUbicacionesDirectly())},1e3),this.loadProperties(),console.log("Properties loaded:",this.properties())}isVendedor(){return this.authFacade.getCurrentUser()?.role===A.VENDEDOR}isAdmin(){return this.authFacade.getCurrentUser()?.role===A.ADMIN}isComprador(){return this.authFacade.getCurrentUser()?.role===A.COMPRADOR}loadCategorias(){this.categoryService.getCategories().subscribe({next:e=>{this.categorias.set(e),console.log("Categories loaded from API:",e)},error:e=>{console.error("Error loading categories:",e),this.categorias.set([{id:1,nombre:"Casa",descripcion:"Casas residenciales",activo:!0,fechaCreacion:new Date().toISOString()},{id:2,nombre:"Apartamento",descripcion:"Apartamentos urbanos",activo:!0,fechaCreacion:new Date().toISOString()},{id:3,nombre:"Casa de lujo",descripcion:"Propiedades premium",activo:!0,fechaCreacion:new Date().toISOString()}])}})}loadUbicaciones(){this.ubicacionService.searchUbicaciones({}).subscribe({next:e=>{let l=e.ubicaciones.map(d=>({id:d.id,ciudad:d.ciudad,departamento:d.departamento,descripcionCiudad:d.descripcionCiudad,descripcionDepartamento:d.descripcionDepartamento,fechaCreacion:d.fechaCreacion,activo:d.activo}));this.ubicaciones.set(l),console.log("Locations loaded from API:",l)},error:e=>{console.error("Error loading locations:",e),this.loadUbicacionesDirectly()}})}loadUbicacionesDirectly(){console.log("Loading ubicaciones directly from localStorage..."),this.ubicaciones.set([{id:1,ciudad:"Medell\xEDn",departamento:"Antioquia",descripcionCiudad:"Ciudad de la eterna primavera",descripcionDepartamento:"Departamento de Antioquia",fechaCreacion:new Date,activo:!0},{id:2,ciudad:"Bogot\xE1",departamento:"Cundinamarca",descripcionCiudad:"Capital de Colombia",descripcionDepartamento:"Departamento de Cundinamarca",fechaCreacion:new Date,activo:!0},{id:3,ciudad:"Cali",departamento:"Valle del Cauca",descripcionCiudad:"Capital del Valle",descripcionDepartamento:"Departamento del suroccidente",fechaCreacion:new Date,activo:!0},{id:4,ciudad:"Cartagena",departamento:"Bol\xEDvar",descripcionCiudad:"Ciudad hist\xF3rica",descripcionDepartamento:"Departamento caribe\xF1o",fechaCreacion:new Date,activo:!0}]),console.log("Direct ubicaciones loaded:",this.ubicaciones())}loadProperties(){this.isLoading.set(!0),this.propertyService.getProperties().subscribe({next:e=>{console.log("Properties response from service:",e),this.properties.set(e.data),this.isLoading.set(!1)},error:e=>{console.error("Error loading properties:",e),this.isLoading.set(!1)}})}reloadProperties(){console.log("Reloading properties..."),this.loadProperties()}toggleForm(){if(!this.isVendedor()){console.warn("Solo vendedores pueden crear propiedades - HU #6");return}this.showForm.set(!this.showForm()),this.showForm()||this.resetForm()}resetForm(){this.propertyForm.reset({cantidad_cuartos:1,cantidad_banos:1,estado_publicacion:"PUBLICADA"}),this.editingProperty.set(null)}onSubmit(){if(!this.isVendedor()){console.error("Error HU #6: Solo vendedores pueden publicar propiedades");return}if(this.propertyForm.valid){this.isSubmitting.set(!0);let e=this.propertyForm.value;console.log("Submitting form data:",e),this.editingProperty()?(console.log("Update property functionality to be implemented"),this.isSubmitting.set(!1)):this.propertyService.createProperty(e).subscribe({next:l=>{console.log("Property created successfully:",l),this.alertService.success("\xC9xito","Propiedad creada exitosamente"),this.resetForm(),this.showForm.set(!1),this.loadProperties(),this.isSubmitting.set(!1)},error:l=>{console.error("Error creating property:",l),this.alertService.error("Error",`Error al crear la propiedad: ${l.message}`),this.isSubmitting.set(!1)}})}}editProperty(e){if(!this.isVendedor()){console.warn("Solo vendedores pueden editar propiedades - HU #6");return}this.editingProperty.set(e),this.propertyForm.patchValue({nombre:e.nombre,descripcion:e.descripcion,categoria_id:e.categoria.id,cantidad_cuartos:e.cantidad_cuartos,cantidad_banos:e.cantidad_banos,precio:e.precio,ubicacion_id:e.ubicacion.id,fecha_publicacion_activa:e.fecha_publicacion_activa.toString().slice(0,16),estado_publicacion:e.estado_publicacion}),this.showForm.set(!0)}deleteProperty(e){return V(this,null,function*(){if(!this.isVendedor()){console.warn("Solo vendedores pueden eliminar propiedades - HU #6");return}let l=this.properties().find(p=>p.id===e);if(!l)return;if(yield this.alertService.confirm("Confirmar eliminaci\xF3n",`\xBFEst\xE1s seguro de que deseas eliminar la propiedad "${l.nombre}"? Esta acci\xF3n no se puede deshacer.`,"Eliminar","Cancelar"))try{this.propertyService.deleteProperty(e).subscribe({next:()=>{this.alertService.success("\xC9xito",`Propiedad "${l.nombre}" eliminada exitosamente`),this.loadProperties()},error:p=>{console.error("Error deleting property:",p),this.alertService.error("Error","Error al eliminar la propiedad. Por favor intenta nuevamente.")}})}catch(p){console.error("Error deleting property:",p),yield this.alertService.error("Error","Error al eliminar la propiedad. Por favor intenta nuevamente.")}})}getStatusClass(e){switch(e){case _.PUBLICADA:return"bg-green-100 text-green-800";case _.PUBLICACION_PAUSADA:return"bg-yellow-100 text-yellow-800";case _.TRANSACCION_CURSO:return"bg-blue-100 text-blue-800";case _.TRANSACCION_FINALIZADA:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}getStatusText(e){switch(e){case _.PUBLICADA:return"Publicada";case _.PUBLICACION_PAUSADA:return"Pausada";case _.TRANSACCION_CURSO:return"En Transacci\xF3n";case _.TRANSACCION_FINALIZADA:return"Finalizada";default:return e}}static \u0275fac=function(l){return new(l||t)};static \u0275cmp=U({type:t,selectors:[["app-properties"]],standalone:!0,features:[L],decls:18,vars:5,consts:[[1,"properties-page"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-secondary-900"],[1,"flex","gap-2"],[1,"bg-secondary-600","text-white","px-4","py-2","rounded-lg","hover:bg-secondary-700","transition-colors","font-medium",3,"click"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-lg","hover:bg-primary-700","transition-colors","font-medium"],[1,"bg-white","rounded-lg","shadow-md","p-6","mb-6"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"px-6","py-4","border-b","border-secondary-200"],[1,"text-lg","font-semibold","text-secondary-900"],[1,"p-6","text-center"],[1,"p-6","text-center","text-secondary-600"],[1,"overflow-x-auto"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-lg","hover:bg-primary-700","transition-colors","font-medium",3,"click"],[1,"text-lg","font-semibold","text-secondary-900","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-secondary-700","mb-2"],[1,"text-red-500"],["type","text","formControlName","nombre","placeholder","Casa en barrio residencial",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["formControlName","categoria_id",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["value",""],[3,"value"],["formControlName","descripcion","rows","3","placeholder","Describe las caracter\xEDsticas principales de la propiedad...",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500","resize-none"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["type","number","formControlName","cantidad_cuartos","min","1","max","20",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["type","number","formControlName","cantidad_banos","min","1","max","10",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["type","number","formControlName","precio","min","1","placeholder","350000000",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["formControlName","ubicacion_id",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["type","datetime-local","formControlName","fecha_publicacion_activa",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500",3,"min","max"],[1,"text-xs","text-secondary-600","mt-1"],["formControlName","estado_publicacion",1,"w-full","px-3","py-2","border","border-secondary-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-primary-500"],["value","PUBLICADA"],["value","PUBLICACION_PAUSADA"],["value","TRANSACCION_CURSO"],["value","TRANSACCION_FINALIZADA"],[1,"flex","justify-end","space-x-3","pt-4"],["type","button",1,"px-4","py-2","border","border-secondary-300","text-secondary-700","rounded-lg","hover:bg-secondary-50","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","bg-primary-600","text-white","rounded-lg","hover:bg-primary-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"disabled"],[1,"mt-4","p-4","bg-red-50","border","border-red-200","rounded-lg"],[1,"text-sm","font-medium","text-red-800","mb-2"],[1,"text-sm","text-red-700","space-y-1"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"],[1,"mt-2","text-secondary-600"],[1,"min-w-full","divide-y","divide-secondary-200"],[1,"bg-secondary-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-secondary-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-secondary-200"],[1,"hover:bg-secondary-50"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-secondary-900"],[1,"text-sm","text-secondary-700"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-secondary-700"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","space-x-2"],[1,"text-primary-600","hover:text-primary-700","transition-colors",3,"click"],[1,"text-red-600","hover:text-red-700","transition-colors","ml-2",3,"click"],[1,"text-primary-600","hover:text-primary-700","transition-colors"],[1,"text-green-600","hover:text-green-700","transition-colors","ml-2"]],template:function(l,d){l&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),m(3,de,1,0)(4,le,1,0),o(),r(5,"div",3)(6,"button",4),b("click",function(){return d.reloadProperties()}),i(7," Recargar "),o(),m(8,pe,3,1,"button",5),o()(),m(9,we,89,7,"div",6),r(10,"div",7)(11,"div",8)(12,"h2",9),m(13,Fe,1,1)(14,Ae,1,1),o()(),m(15,De,4,0,"div",10)(16,Ie,3,1,"div",11)(17,qe,19,0,"div",12),o()()),l&2&&(a(3),c(d.isVendedor()?3:4),a(5),c(d.isVendedor()?8:-1),a(),c(d.showForm()&&d.isVendedor()?9:-1),a(4),c(d.isVendedor()?13:14),a(2),c(d.isLoading()?15:d.properties().length===0?16:17))},dependencies:[B,M,ie,z,W,X,G,Z,Q,H,j,ee,Y,J,K],styles:[".properties-page[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;max-width:80rem;padding:1.5rem}"],changeDetection:0})}return t})();export{Xe as PropertiesComponent};
