import{a as j}from"./chunk-DWWM3IXI.js";import"./chunk-OATTNESZ.js";import{b as q,c as T,d as G,e as A,h as z,j as O,k as R,s as U,u as $}from"./chunk-46JGFRV7.js";import{x as P}from"./chunk-3KOIEGY5.js";import{c as N,e as H}from"./chunk-BZNYC5N3.js";import"./chunk-XOLXN3IC.js";import{Ac as B,Ca as v,Da as _,Db as o,Ea as E,Eb as t,Fa as y,Fb as g,Gb as F,Hb as b,Ib as m,Mb as n,Nb as w,Ob as S,Pb as M,Vb as k,hb as s,na as u,nb as p,sb as x,ta as I,vb as V,xb as L,zb as c}from"./chunk-PHL42RAN.js";function Y(r,d){r&1&&n(0," El email es requerido ")}function J(r,d){r&1&&n(0," Ingrese un email v\xE1lido ")}function K(r,d){if(r&1&&(o(0,"p",13),x(1,Y,1,0)(2,J,1,0),t()),r&2){let i,e,l=m(2);s(),c(!((i=l.visitForm.get("compradorEmail"))==null||i.errors==null)&&i.errors.required?1:-1),s(),c(!((e=l.visitForm.get("compradorEmail"))==null||e.errors==null)&&e.errors.email?2:-1)}}function Q(r,d){r&1&&n(0," Agendando... ")}function W(r,d){r&1&&n(0," Confirmar Visita ")}function X(r,d){if(r&1){let i=F();o(0,"div",7)(1,"h2",8),n(2,"Detalles de la Visita"),t(),o(3,"div",9)(4,"div")(5,"strong"),n(6,"Propiedad:"),t(),n(7),t(),o(8,"div")(9,"strong"),n(10,"Ubicaci\xF3n:"),t(),n(11),t(),o(12,"div")(13,"strong"),n(14,"Fecha y Hora:"),t(),n(15),t(),o(16,"div")(17,"strong"),n(18,"Precio:"),t(),n(19),t(),o(20,"div")(21,"strong"),n(22,"Espacios Disponibles:"),t(),n(23),t()()(),o(24,"form",10),b("ngSubmit",function(){v(i);let l=m();return _(l.scheduleVisit())}),o(25,"div")(26,"label",11),n(27," Email del Comprador * "),t(),g(28,"input",12),x(29,K,3,2,"p",13),t(),o(30,"div")(31,"label",14),n(32," Comentarios adicionales "),t(),g(33,"textarea",15),t(),o(34,"div",16)(35,"h3",17),n(36,"T\xE9rminos y Condiciones"),t(),o(37,"ul",18)(38,"li"),n(39,"\u2022 La visita est\xE1 sujeta a confirmaci\xF3n por parte del vendedor"),t(),o(40,"li"),n(41,"\u2022 Se recomienda llegar 5 minutos antes de la hora programada"),t(),o(42,"li"),n(43,"\u2022 M\xE1ximo 2 compradores por horario (HU #11)"),t(),o(44,"li"),n(45,"\u2022 La cancelaci\xF3n debe hacerse con al menos 2 horas de anticipaci\xF3n"),t()()(),o(46,"div",19)(47,"button",20),b("click",function(){v(i);let l=m();return _(l.goBack())}),n(48," Cancelar "),t(),o(49,"button",21),x(50,Q,1,0)(51,W,1,0),t()()()}if(r&2){let i,e,l,C,D,h,f,a=m();s(7),S(" ",(i=a.selectedSchedule())==null||i.casa==null?null:i.casa.nombre,""),s(4),M(" ",(e=a.selectedSchedule())==null||e.casa==null||e.casa.ubicacion==null?null:e.casa.ubicacion.ciudad,", ",(e=a.selectedSchedule())==null||e.casa==null||e.casa.ubicacion==null?null:e.casa.ubicacion.departamento,""),s(4),M(" ",a.formatDateTime((l=a.selectedSchedule())==null?null:l.fechaHoraInicio)," - ",a.formatTime((l=a.selectedSchedule())==null?null:l.fechaHoraFin),""),s(4),S(" ",a.formatPrice((C=a.selectedSchedule())==null||C.casa==null?null:C.casa.precio),""),s(4),S(" ",(D=a.selectedSchedule())==null?null:D.espaciosDisponibles,""),s(),V("formGroup",a.visitForm),s(4),L("border-red-500",((h=a.visitForm.get("compradorEmail"))==null?null:h.invalid)&&((h=a.visitForm.get("compradorEmail"))==null?null:h.touched)),s(),c((f=a.visitForm.get("compradorEmail"))!=null&&f.invalid&&((f=a.visitForm.get("compradorEmail"))!=null&&f.touched)?29:-1),s(20),V("disabled",a.visitForm.invalid||a.submitting()),s(),c(a.submitting()?50:51)}}function Z(r,d){r&1&&(o(0,"div",4),g(1,"div",22),o(2,"p",23),n(3,"Cargando informaci\xF3n del horario..."),t()())}function ee(r,d){if(r&1){let i=F();o(0,"div",4)(1,"p",24),n(2,"No se pudo cargar la informaci\xF3n del horario seleccionado."),t(),o(3,"button",25),b("click",function(){v(i);let l=m();return _(l.goBack())}),n(4," Volver a Horarios "),t()()}}function te(r,d){if(r&1&&(o(0,"div",5)(1,"div",26),E(),o(2,"svg",27),g(3,"path",28),t(),y(),o(4,"p",29),n(5),t()()()),r&2){let i=m();s(5),w(i.successMessage())}}function ie(r,d){if(r&1&&(o(0,"div",6)(1,"div",26),E(),o(2,"svg",30),g(3,"path",31),t(),y(),o(4,"p",32),n(5),t()()()),r&2){let i=m();s(5),w(i.errorMessage())}}var ue=(()=>{class r{visitService=u(j);authFacade=u(P);router=u(H);route=u(N);formBuilder=u(U);selectedSchedule=p(null);loading=p(!1);submitting=p(!1);successMessage=p("");errorMessage=p("");visitForm=this.formBuilder.group({compradorEmail:["",[T.required,T.email]],comentarios:[""]});ngOnInit(){let i=this.route.snapshot.queryParams.scheduleId;i?this.loadScheduleDetails(i):this.errorMessage.set("No se especific\xF3 un horario para agendar");let e=this.authFacade.getCurrentUser();e?.correo&&this.visitForm.patchValue({compradorEmail:e.correo})}loadScheduleDetails(i){this.loading.set(!0),this.visitService.getScheduleById(parseInt(i)).subscribe({next:e=>{e.espaciosDisponibles>0&&new Date(e.fechaHoraInicio)>new Date?this.selectedSchedule.set(e):this.errorMessage.set("Este horario ya no est\xE1 disponible para agendar"),this.loading.set(!1)},error:e=>{console.error("Error loading schedule details:",e),this.errorMessage.set("Error al cargar los detalles del horario"),this.loading.set(!1)}})}scheduleVisit(){if(this.visitForm.valid&&this.selectedSchedule()){this.submitting.set(!0),this.errorMessage.set(""),this.successMessage.set("");let i={horarioDisponible:this.selectedSchedule(),compradorEmail:this.visitForm.value.compradorEmail,comentarios:this.visitForm.value.comentarios};this.visitService.scheduleVisit(i).subscribe({next:e=>{this.successMessage.set("\xA1Visita agendada exitosamente! El vendedor confirmar\xE1 su visita pronto."),this.submitting.set(!1),setTimeout(()=>{this.router.navigate(["/comprador/visitas"])},3e3)},error:e=>{console.error("Error scheduling visit:",e),e.status===400?this.errorMessage.set("Ya existen 2 compradores agendados para este horario. Por favor, seleccione otro horario."):this.errorMessage.set("Error al agendar la visita. Por favor, int\xE9ntelo nuevamente."),this.submitting.set(!1)}})}}formatDateTime(i){return new Date(i).toLocaleString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatTime(i){return new Date(i).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}formatPrice(i){return i?`$${i.toLocaleString("es-CO")}`:"$0"}goBack(){this.router.navigate(["/horarios-disponibles"])}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-schedule-visit"]],standalone:!0,features:[k],decls:10,vars:3,consts:[[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-2xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-6"],[1,"text-center","py-8"],[1,"mt-4","bg-green-50","border","border-green-200","rounded-lg","p-4"],[1,"mt-4","bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-6"],[1,"text-lg","font-semibold","text-blue-900","mb-2"],[1,"space-y-2","text-sm","text-blue-800"],[1,"space-y-6",3,"ngSubmit","formGroup"],["for","compradorEmail",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","email","id","compradorEmail","formControlName","compradorEmail",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"mt-1","text-sm","text-red-600"],["for","comentarios",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","comentarios","formControlName","comentarios","rows","3","placeholder","Escriba cualquier comentario o pregunta adicional...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"text-sm","font-medium","text-gray-900","mb-2"],[1,"text-xs","text-gray-600","space-y-1"],[1,"flex","space-x-4"],["type","button",1,"flex-1","bg-gray-600","text-white","py-2","px-4","rounded-md","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-gray-500",3,"click"],["type","submit",1,"flex-1","bg-green-600","text-white","py-2","px-4","rounded-md","hover:bg-green-700","focus:outline-none","focus:ring-2","focus:ring-green-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto"],[1,"mt-2","text-gray-600"],[1,"text-red-600"],[1,"mt-4","bg-blue-600","text-white","py-2","px-4","rounded-md","hover:bg-blue-700",3,"click"],[1,"flex"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-green-400","mr-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-green-800"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-400","mr-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-red-800"]],template:function(e,l){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"Agendar Visita"),t(),x(5,X,52,13)(6,Z,4,0,"div",4)(7,ee,5,0,"div",4)(8,te,6,1,"div",5)(9,ie,6,1,"div",6),t()()()),e&2&&(s(5),c(l.selectedSchedule()?5:l.loading()?6:7),s(3),c(l.successMessage()?8:-1),s(),c(l.errorMessage()?9:-1))},dependencies:[B,$,z,q,G,A,O,R],encapsulation:2})}return r})();export{ue as ScheduleVisitComponent};
